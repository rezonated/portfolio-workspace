{"config":{"lang":["en"],"separator":"[\\s\\-]+","pipeline":["stopWordFilter"]},"docs":[{"location":"","title":"Project Wikis","text":"<p>Welcome to my project documentation hub.</p> <ul> <li>Unreal Fishing</li> </ul>"},{"location":"fishing/","title":"Wiki Documentation for https://github.com/rezonated/Unreal-Fishing-Test","text":"<p>Generated on: 2025-11-08 16:56:06</p>"},{"location":"fishing/#table-of-contents","title":"Table of Contents","text":"<ul> <li>Home</li> <li>Getting Started</li> <li>Module Overview</li> <li>Core Gameplay Classes</li> <li>Messaging System (VAGameplayMessaging)</li> <li>Fishing Gameplay Loop</li> <li>Player Input and Controls</li> <li>Configuration with Data Assets</li> <li>UI Widgets</li> <li>Functional Testing</li> </ul>"},{"location":"fishing/#home","title":"Home","text":""},{"location":"fishing/#related-pages","title":"Related Pages","text":"<p>Related topics: Getting Started</p> Relevant source files  The following files were used as context for generating this wiki page:  - [Source/FishingFeature/Private/ActorComponent/ActorComponent_FishingComponent.cpp](https://github.com/rezonated/Unreal-Fishing-Test/blob/main/Source/FishingFeature/Private/ActorComponent/ActorComponent_FishingComponent.cpp) - [Source/StairwayFishingGameCore/Private/PlayerController/PlayerController_StairwayFishingGamePlayerController.cpp](https://github.com/rezonated/Unreal-Fishing-Test/blob/main/Source/StairwayFishingGameCore/Private/PlayerController/PlayerController_StairwayFishingGamePlayerController.cpp) - [Source/VAGameplayMessaging/Private/GameInstanceSubsystem/VAGameplayMessagingSubsystem.cpp](https://github.com/rezonated/Unreal-Fishing-Test/blob/main/Source/VAGameplayMessaging/Private/GameInstanceSubsystem/VAGameplayMessagingSubsystem.cpp) - [Source/FishingGameplayTags/Public/FishingTags.h](https://github.com/rezonated/Unreal-Fishing-Test/blob/main/Source/FishingGameplayTags/Public/FishingTags.h) - [Source/StairwayFishingGameCore/Private/GameModeBase/GameModeBase_StairwayFishingGame.cpp](https://github.com/rezonated/Unreal-Fishing-Test/blob/main/Source/StairwayFishingGameCore/Private/GameModeBase/GameModeBase_StairwayFishingGame.cpp) - [Source/FishingFeature/Private/Actor/Actor_FishingRod.cpp](https://github.com/rezonated/Unreal-Fishing-Test/blob/main/Source/FishingFeature/Private/Actor/Actor_FishingRod.cpp) - [Source/FishingFeature/Private/Actor/Actor_Fish.cpp](https://github.com/rezonated/Unreal-Fishing-Test/blob/main/Source/FishingFeature/Private/Actor/Actor_Fish.cpp) - [Source/FishingFeature/Private/Actor/Actor_FishSpawnArea.cpp](https://github.com/rezonated/Unreal-Fishing-Test/blob/main/Source/FishingFeature/Private/Actor/Actor_FishSpawnArea.cpp) - [Source/StairwayFishingGameCore/Private/Pawn/Pawn_StairwayFishingGame.cpp](https://github.com/rezonated/Unreal-Fishing-Test/blob/main/Source/StairwayFishingGameCore/Private/Pawn/Pawn_StairwayFishingGame.cpp)"},{"location":"fishing/#home_1","title":"Home","text":""},{"location":"fishing/#introduction","title":"Introduction","text":"<p>The Unreal Fishing Test project implements a modular, event-driven fishing gameplay system. The core architecture is centered around the <code>UActorComponent_FishingComponent</code>, which acts as the primary logic controller for all fishing-related actions. The system is decoupled through the extensive use of a <code>UVAGameplayMessagingSubsystem</code> and <code>FGameplayTag</code> for state management and event communication, allowing different parts of the system (UI, animation, game logic) to react to events without direct dependencies.</p> <p>The gameplay loop involves player input for casting, a timed waiting period, and reeling in a catch. The system features distinct actors for the fishing rod, the fish, and spawn areas, each with its own configurable behavior driven by <code>UDataAsset</code> instances. This data-driven approach allows for easy tuning of parameters like cast distance, fish behavior, and spawn rates without altering code. High-level game states, such as transitioning from fishing to displaying the caught fish, are managed by the <code>AGameModeBase_StairwayFishingGame</code>, which handles camera transitions and player input modes.</p>"},{"location":"fishing/#system-architecture","title":"System Architecture","text":"<p>The fishing system is composed of several key classes that interact to create the complete gameplay experience. The <code>UActorComponent_FishingComponent</code> is the central orchestrator, attached to the player pawn. It processes input, manages the fishing state machine, and communicates with other actors and systems.</p> <p>Sources: Source/FishingFeature/Private/ActorComponent/ActorComponent_FishingComponent.cpp, Source/StairwayFishingGameCore/Private/PlayerController/PlayerController_StairwayFishingGamePlayerController.cpp</p> <p><pre><code>classDiagram\ndirection TD\nclass APlayerController_StairwayFishingGamePlayerController {\n    +UInputMappingContext* DefaultInputMappingContext\n    +UInputAction* CastingInputAction\n    +FOnPlayerActionInput OnCastStartedDelegate\n    +FOnPlayerActionInput OnCastTriggeredDelegate\n    +FOnPlayerActionInput OnCastCompletedDelegate\n    +OnCastStarted()\n    +OnCastTriggered()\n    +OnCastFinished()\n}\n\nclass UActorComponent_FishingComponent {\n    -FGameplayTag CurrentFishingState\n    -ICatcherInterface* CurrentCatcher\n    -ICatchableInterface* CurrentCatchable\n    +OnCastAction()\n    +OnCastActionEnded()\n    +ReelBack()\n    +AttemptGetNearestCatchable()\n}\n\nclass AActor_FishingRod {\n    +UStaticMeshComponent* FishingRodMeshComponent\n    +UStaticMeshComponent* BobberMeshComponent\n    +Throw(FVector InCastLocation)\n    +ReelBack()\n}\n\nclass AActor_Fish {\n    -bool bBeingTargeted\n    +ReeledIn(FVector RodLocation)\n    +Escape()\n    +WanderWithinBoundingBox()\n}\n\nclass AActor_FishSpawnArea {\n    +UBoxComponent* SpawnAreaBox\n    +RequestLoadFishAssetSoftClass()\n    +SpawnFishes()\n}\n\nclass AGameModeBase_StairwayFishingGame {\n    +OnFishingGameLoopStateChanged(FGameplayTag)\n    +TriggerScreenFadeInOut()\n}\n\nclass UVAGameplayMessagingSubsystem {\n    +BroadcastMessage(FGameplayTag, FVAAnyUnreal)\n    +RegisterNewMember(FGameplayTagContainer, listener)\n}\n\nclass FFishingTags {\n    &lt;&lt;static&gt;&gt;\n    +FGameplayTag Messaging_Fishing_Notify_Throw\n    +FGameplayTag FishingComponent_State_Idling\n    +FGameplayTag FishingGameLoopState_Fishing\n}\n\nAPlayerController_StairwayFishingGamePlayerController --|&gt; IPlayerActionInputInterface\nUActorComponent_FishingComponent ..&gt; APlayerController_StairwayFishingGamePlayerController : Binds to delegates\nUActorComponent_FishingComponent --o APawn_StairwayFishingGame : \"component\"\nUActorComponent_FishingComponent ..&gt; AActor_FishingRod : \"controls\"\nUActorComponent_FishingComponent ..&gt; AActor_Fish : \"catches\"\nUActorComponent_FishingComponent ..&gt; UVAGameplayMessagingSubsystem : \"uses\"\nAGameModeBase_StairwayFishingGame ..&gt; UVAGameplayMessagingSubsystem : \"uses\"\nAActor_FishSpawnArea ..&gt; AActor_Fish : \"spawns\"\nAGameModeBase_StairwayFishingGame ..&gt; APawn_StairwayFishingGame : \"manages\"\nUVAGameplayMessagingSubsystem ..&gt; FFishingTags : \"uses tags for channels\"\nUActorComponent_FishingComponent ..&gt; FFishingTags : \"uses tags for state\"\n</code></pre> This diagram illustrates the primary classes and their relationships. The <code>PlayerController</code> captures input and invokes delegates that the <code>FishingComponent</code> listens to. The <code>FishingComponent</code> then drives the behavior of the <code>FishingRod</code> and interacts with <code>Fish</code> actors, which are spawned by the <code>FishSpawnArea</code>. All major state changes and events are communicated via the <code>VAGameplayMessagingSubsystem</code> using channels defined in <code>FFishingTags</code>.</p> <p>Sources: Source/FishingFeature/Private/ActorComponent/ActorComponent_FishingComponent.cpp, Source/StairwayFishingGameCore/Public/PlayerController/PlayerController_StairwayFishingGamePlayerController.h, Source/FishingFeature/Public/Actor/Actor_FishSpawnArea.h, Source/VAGameplayMessaging/Private/GameInstanceSubsystem/VAGameplayMessagingSubsystem.cpp, Source/FishingGameplayTags/Public/FishingTags.h</p>"},{"location":"fishing/#core-gameplay-loop-casting-and-catching","title":"Core Gameplay Loop: Casting and Catching","text":"<p>The fishing process is a multi-stage sequence initiated by the player and managed by the <code>UActorComponent_FishingComponent</code>. It flows from input capture, through casting and waiting, to finally reeling in a fish.</p>"},{"location":"fishing/#input-handling","title":"Input Handling","text":"<p>Player input is the entry point for the fishing mechanic. The <code>APlayerController_StairwayFishingGamePlayerController</code> is responsible for binding hardware input to gameplay actions.</p> <ol> <li>On <code>BeginPlay</code>, the controller maps the <code>DefaultInputMappingContext</code>.</li> <li>The <code>CastingInputAction</code> is bound to three separate trigger events: <code>Started</code>, <code>Triggered</code>, and <code>Completed</code>.</li> <li>Each event calls a corresponding handler (<code>OnCastStarted</code>, <code>OnCastTriggered</code>, <code>OnCastFinished</code>), which in turn executes a public delegate (<code>OnCastStartedDelegate</code>, etc.).</li> <li>The <code>UActorComponent_FishingComponent</code> binds its own functions (<code>OnCastAction</code>, <code>OnCastActionEnded</code>) to these delegates to initiate and conclude the fishing actions.</li> </ol> <p>Sources: Source/StairwayFishingGameCore/Private/PlayerController/PlayerController_StairwayFishingGamePlayerController.cpp:13-22, 60-77, Source/FishingFeature/Private/ActorComponent/ActorComponent_FishingComponent.cpp:333-356</p> <p><pre><code>sequenceDiagram\n    participant Player\n    participant PC as APlayerController\n    participant FC as UActorComponent_FishingComponent\n    participant UI\n\n    Player-&gt;&gt;+PC: Press and Hold Cast Button\n    PC-&gt;&gt;PC: OnCastStarted()\n    PC--&gt;&gt;FC: OnCastStartedDelegate.Execute()\n    FC-&gt;&gt;+FC: OnCastAction(elapsedTime)\n    FC-&gt;&gt;FC: ToggleDecalVisibility(true)\n    loop While Button is Held\n        PC-&gt;&gt;PC: OnCastTriggered()\n        PC--&gt;&gt;FC: OnCastTriggeredDelegate.Execute()\n        FC-&gt;&gt;FC: OnCastAction(elapsedTime)\n        FC-&gt;&gt;FC: DetermineCastLocation(elapsedTime)\n        FC--&gt;&gt;UI: BroadcastUIMessage(progress)\n    end\n    Player-&gt;&gt;-PC: Release Cast Button\n    PC-&gt;&gt;PC: OnCastFinished()\n    PC--&gt;&gt;FC: OnCastCompletedDelegate.Execute()\n    FC-&gt;&gt;FC: OnCastActionEnded()\n    FC-&gt;&gt;-FC: ToggleDecalVisibility(false)\n</code></pre> This sequence shows how player input is translated into continuous updates for the casting power and visual feedback, culminating in the final cast action when the input is released.</p>"},{"location":"fishing/#the-fishing-sequence","title":"The Fishing Sequence","text":"<p>Once the cast is initiated by <code>OnCastActionEnded</code>, a complex sequence of events involving animations, timelines, and messaging occurs to simulate the fishing process.</p> <p><pre><code>sequenceDiagram\n    autonumber\n    participant FC as FishingComponent\n    participant GMS as VAGameplayMessagingSubsystem\n    participant Anim as AnimInstance\n    participant Rod as AActor_FishingRod\n    participant Fish as AActor_Fish\n    participant GM as GameMode\n\n    FC-&gt;&gt;+GMS: BroadcastMessage(AnimInstance_State_Throwing)\n    GMS--&gt;&gt;Anim: OnGameplayMessageReceived\n    Anim-&gt;&gt;Anim: Play Throw Montage\n    Note right of Anim: Montage contains Anim Notifies\n    Anim-&gt;&gt;+GMS: BroadcastMessage(Notify_Throw)\n    GMS--&gt;&gt;-FC: OnThrowNotifyMessageReceived\n    FC-&gt;&gt;+Rod: Throw(CastLocation)\n    Rod-&gt;&gt;Rod: ThrowReelInTimeline.PlayFromStart()\n    Note over Rod: Animates bobber to water\n    Rod--&gt;&gt;-FC: CatchableLandsOnWaterDelegate.Execute()\n    FC-&gt;&gt;+FC: OnBobberLandsOnWater()\n    FC-&gt;&gt;FC: AttemptGetNearestCatchable()\n    FC-&gt;&gt;+Fish: ReeledIn(RodLocation)\n    Fish-&gt;&gt;Fish: ReeledInTimeline.PlayFromStart()\n    Note over Fish: Animates fish towards bobber\n    FC-&gt;&gt;FC: StartWaitingForFishTimer()\n    FC--&gt;&gt;-FC: CurrentFishingState = WaitingForFish\n\n    alt Player Reels In Successfully\n        Note over FC: Timer completes, player reels\n        FC-&gt;&gt;+GMS: BroadcastMessage(AnimInstance_State_Reeling_In)\n        GMS--&gt;&gt;Anim: OnGameplayMessageReceived\n        Anim-&gt;&gt;Anim: Play Reel In Montage\n        Anim-&gt;&gt;+GMS: BroadcastMessage(Notify_ReelDone)\n        GMS--&gt;&gt;-FC: OnReelDoneNotifyMessageReceived\n        FC-&gt;&gt;+GMS: BroadcastMessage(GameState_StateChange, ShowFish)\n        GMS--&gt;&gt;-GM: OnGameplayMessageReceived\n        GM-&gt;&gt;GM: OnFishingGameLoopStateChanged(ShowFish)\n    else Player Fails or Releases Early\n        FC-&gt;&gt;+Fish: Escape()\n        Fish-&gt;&gt;Fish: EscapeTimeline.PlayFromStart()\n        Fish--&gt;&gt;-Fish: bBeingTargeted = false\n        FC-&gt;&gt;FC: ReelBack()\n        FC--&gt;&gt;-FC: ResetStateAndTimer()\n    end\n</code></pre> This diagram details the event-driven flow of the fishing action. The <code>FishingComponent</code> initiates state changes by sending messages, which are received by the Animation Instance. The animation, in turn, sends notify messages back at key moments, driving the logic forward without the <code>FishingComponent</code> needing to know about animation specifics.</p> <p>Sources: Source/FishingFeature/Private/ActorComponent/ActorComponent_FishingComponent.cpp:525-540, 584-593, 735-742, Source/FishingFeature/Private/Actor/Actor_FishingRod.cpp:32-36, 185-190, Source/FishingFeature/Private/Actor/Actor_Fish.cpp:35-41, 260-265, Source/StairwayFishingGameCore/Private/GameModeBase/GameModeBase_StairwayFishingGame.cpp:20-22</p>"},{"location":"fishing/#key-components-and-actors","title":"Key Components and Actors","text":""},{"location":"fishing/#uactorcomponent_fishingcomponent","title":"<code>UActorComponent_FishingComponent</code>","text":"<p>This is the central class of the feature, responsible for managing the entire fishing lifecycle.</p> Responsibility Description State Management Uses <code>FGameplayTag</code> to track the current state (e.g., <code>Idling</code>, <code>Throwing</code>, <code>WaitingForFish</code>). Input Binding Binds to delegates from the <code>PlayerController</code> to react to player input. Actor Spawning Asynchronously loads and spawns the <code>AActor_FishingRod</code>. Logic Orchestration Calls functions on the <code>FishingRod</code> and <code>Fish</code> actors at appropriate times. Event Handling Listens for messages (e.g., animation notifies) from the <code>VAGameplayMessagingSubsystem</code>. Physics/Tracing Performs line traces to find a valid water surface for casting and sphere traces to find nearby fish. <p>The component's behavior is highly configurable through <code>UDataAsset_FishingComponentConfig</code>, which defines properties like cast range, timing, and socket names for attaching the rod.</p> <p>Sources: Source/FishingFeature/Private/ActorComponent/ActorComponent_FishingComponent.cpp</p>"},{"location":"fishing/#aactor_fishingrod","title":"<code>AActor_FishingRod</code>","text":"<p>This actor is the visual representation of the fishing rod and bobber.</p> <ul> <li>Components: It consists of a <code>FishingRodMeshComponent</code> (the rod) and a <code>BobberMeshComponent</code>. A <code>CatchableAttachPoint</code> is attached to the bobber for holding the fish.</li> <li>Animation: It does not use skeletal animation. Instead, it uses <code>FTimeline</code> objects driven by <code>UCurveFloat</code> assets to smoothly interpolate the bobber's position when <code>Throw()</code> and <code>ReelBack()</code> are called. This provides a simple yet effective procedural animation.</li> </ul> <p>Sources: Source/FishingFeature/Private/Actor/Actor_FishingRod.cpp:16-28, 102-121</p>"},{"location":"fishing/#aactor_fish","title":"<code>AActor_Fish</code>","text":"<p>Represents a single fish that can be caught.</p> <ul> <li>AI Behavior: When not targeted, the fish performs a simple <code>WanderWithinBoundingBox</code> behavior, moving towards random points within the confines of its <code>AActor_FishSpawnArea</code>.</li> <li>State: A boolean <code>bBeingTargeted</code> flag controls whether the fish is wandering or being interacted with.</li> <li>Interaction: Implements the <code>ICatchableInterface</code>. The <code>ReeledIn</code> function triggers a timeline to move the fish towards the bobber. The <code>Escape</code> function triggers a different timeline to return it to its initial location.</li> </ul> <p>Sources: Source/FishingFeature/Private/Actor/Actor_Fish.cpp:35-47, 137-153</p>"},{"location":"fishing/#aactor_fishspawnarea","title":"<code>AActor_FishSpawnArea</code>","text":"<p>This actor defines a volume in the world where fish can be spawned and exist.</p> <ul> <li>Spawning Logic: On <code>BeginPlay</code>, it asynchronously requests to load the fish actor's class from a <code>TSoftClassPtr</code> defined in its config data asset.</li> <li>Async Loading: It uses <code>UAssetManager::GetStreamableManager().RequestAsyncLoad</code> to prevent hitches from loading the fish asset.</li> <li>Volume: Once the asset is loaded, it spawns a configured number of fish at random locations within its <code>UBoxComponent</code> bounds. It also passes its bounds to each fish so they know the area within which they can wander.</li> </ul> <p>Sources: Source/FishingFeature/Private/Actor/Actor_FishSpawnArea.cpp:40-50, 93-100</p>"},{"location":"fishing/#state-and-event-management","title":"State and Event Management","text":"<p>The system is heavily reliant on a decoupled messaging system and gameplay tags for managing state and communication.</p>"},{"location":"fishing/#gameplay-tags-ffishingtags","title":"Gameplay Tags (<code>FFishingTags</code>)","text":"<p>A central singleton class, <code>FFishingTags</code>, defines all gameplay tags used by the system. This prevents errors from typos and provides a single source of truth for all tags.</p> Tag Category Example Purpose Messaging Channel <code>Messaging.Fishing.Notify.Throw</code> Used as a channel ID for broadcasting and listening to events. Anim Instance State <code>AnimInstance.Fishing.State.Throwing</code> Sent to the Animation Blueprint to trigger a specific animation state. Component State <code>FishingComponent.State.WaitingForFish</code> Used internally by <code>FishingComponent</code> to manage its state machine. Game Loop State <code>FishingGameLoopState.ShowFish</code> A high-level state managed by the Game Mode. <p>Sources: Source/FishingGameplayTags/Public/FishingTags.h:23-132</p>"},{"location":"fishing/#game-mode-state-transitions","title":"Game Mode State Transitions","text":"<p>The <code>AGameModeBase_StairwayFishingGame</code> handles high-level game states that affect the entire experience, such as switching between active gameplay and a cinematic view of a caught fish.</p> <p><pre><code>stateDiagram-v2\n    direction TD\n    [*] --&gt; Fishing\n    Fishing: Player can cast and fish\n    ShowFish: Player input disabled, shows caught fish\n\n    Fishing --&gt; ShowFish: On successful catch\n    ShowFish --&gt; Fishing: On returning to gameplay\n</code></pre> This state transition is handled in <code>OnFishingGameLoopStateChanged</code>. When the state changes, this function: 1.  Toggles player input between <code>FInputModeGameOnly</code> and <code>FInputModeUIOnly</code>. 2.  Initiates a camera fade-out. 3.  Switches the active camera on the pawn (which implements <code>ISwitchableFishingViewInterface</code>). 4.  Broadcasts a <code>Messaging_GameMode_StateChangeFinish</code> message. 5.  Initiates a camera fade-in.</p> <p>Sources: Source/StairwayFishingGameCore/Private/GameModeBase/GameModeBase_StairwayFishingGame.cpp:20-84, Source/StairwayFishingGameCore/Private/Pawn/Pawn_StairwayFishingGame.cpp:64-82</p>"},{"location":"fishing/#conclusion","title":"Conclusion","text":"<p>The fishing system in this project is a well-structured and scalable feature built on modern Unreal Engine patterns. Its strength lies in its modular, component-based design and its use of a decoupled messaging system for communication. The data-driven configuration via <code>UDataAsset</code>s makes it easy for designers to tweak and balance the gameplay without programmer intervention. The clear separation of concerns\u2014input handling in the <code>PlayerController</code>, core logic in the <code>ActorComponent</code>, and visual representation in various <code>Actor</code> classes\u2014makes the system maintainable and extensible.</p> <p></p>"},{"location":"fishing/#getting-started","title":"Getting Started","text":""},{"location":"fishing/#related-pages_1","title":"Related Pages","text":"<p>Related topics: Home, Functional Testing</p> Relevant source files  The following files were used as context for generating this wiki page:  - [Source\\StairwayFishingGameCore\\Private\\GameModeBase\\GameModeBase_StairwayFishingGame.cpp](https://github.com/rezonated/Unreal-Fishing-Test/blob/main/Source/StairwayFishingGameCore/Private/GameModeBase/GameModeBase_StairwayFishingGame.cpp) - [Source\\FishingFeature\\Private\\Actor\\Actor_FishSpawnArea.cpp](https://github.com/rezonated/Unreal-Fishing-Test/blob/main/Source/FishingFeature/Private/Actor/Actor_FishSpawnArea.cpp) - [Source\\FishingFeature\\Private\\ActorComponent\\ActorComponent_FishingComponent.cpp](https://github.com/rezonated/Unreal-Fishing-Test/blob/main/Source/FishingFeature/Private/ActorComponent/ActorComponent_FishingComponent.cpp) - [Source\\FishingFeature\\Private\\Actor\\Actor_FishingRod.cpp](https://github.com/rezonated/Unreal-Fishing-Test/blob/main/Source/FishingFeature/Private/Actor/Actor_FishingRod.cpp) - [Source\\StairwayFishingGameCore\\Private\\PlayerController\\PlayerController_StairwayFishingGamePlayerController.cpp](https://github.com/rezonated/Unreal-Fishing-Test/blob/main/Source/StairwayFishingGameCore/Private/PlayerController/PlayerController_StairwayFishingGamePlayerController.cpp) - [Source\\StairwayFishingGameCore\\Private\\Pawn\\Pawn_StairwayFishingGame.cpp](https://github.com/rezonated/Unreal-Fishing-Test/blob/main/Source/StairwayFishingGameCore/Private/Pawn/Pawn_StairwayFishingGame.cpp) - [Source\\FishingFeature\\Private\\Actor\\Actor_Fish.cpp](https://github.com/rezonated/Unreal-Fishing-Test/blob/main/Source/FishingFeature/Private/Actor/Actor_Fish.cpp) - [Source\\VAGameplayMessaging\\Private\\GameInstanceSubsystem\\VAGameplayMessagingSubsystem.cpp](https://github.com/rezonated/Unreal-Fishing-Test/blob/main/Source/VAGameplayMessaging/Private/GameInstanceSubsystem/VAGameplayMessagingSubsystem.cpp) - [Source\\FishingGameplayTags\\Public\\FishingTags.h](https://github.com/rezonated/Unreal-Fishing-Test/blob/main/Source/FishingGameplayTags/Public/FishingTags.h) - [Source\\FishingFeatureEditor\\Private\\DetailCustomization\\DetailCustomization_FishingComponent.cpp](https://github.com/rezonated/Unreal-Fishing-Test/blob/main/Source/FishingFeatureEditor/Private/DetailCustomization/DetailCustomization_FishingComponent.cpp)"},{"location":"fishing/#getting-started_1","title":"Getting Started","text":"<p>This document provides a comprehensive technical overview of the fishing gameplay system in the Unreal-Fishing-Test project. The system is a self-contained feature designed to handle all aspects of fishing, from casting a line to catching a fish. It is built upon several core components, a data-driven configuration approach using Data Assets, and a decoupled messaging system for communication between different parts of the game. The core logic is encapsulated within an Actor Component, making it portable and easy to attach to any player character.</p> <p>The architecture emphasizes separation of concerns: player input, fishing logic, actor behaviors (fish, fishing rod), and game state transitions are all handled by distinct classes. Communication is facilitated by the <code>VAGameplayMessagingSubsystem</code>, which uses <code>FGameplayTag</code> as channels to broadcast and listen for events, avoiding hard references between components. This guide will detail the key components, the overall gameplay flow, the state management system, and the configuration options available to designers.</p>"},{"location":"fishing/#core-architecture-and-components","title":"Core Architecture and Components","text":"<p>The fishing system is composed of several key classes that work together to create the full gameplay experience. The main components are the Player Pawn, the Fishing Component, the Fishing Rod, the Fish, and the Fish Spawn Area.</p> <p>Sources: Source\\StairwayFishingGameCore\\Private\\Pawn\\Pawn_StairwayFishingGame.cpp, Source\\FishingFeature\\Private\\ActorComponent\\ActorComponent_FishingComponent.cpp, Source\\FishingFeature\\Private\\Actor\\Actor_FishingRod.cpp, Source\\FishingFeature\\Private\\Actor\\Actor_Fish.cpp, Source\\FishingFeature\\Private\\Actor\\Actor_FishSpawnArea.cpp</p> <p><pre><code>classDiagram\ndirection TD\n\nclass APawn_StairwayFishingGame {\n    +UActorComponent_FishingComponent* FishingComponent\n    +UCameraComponent* Camera\n    +UCameraComponent* ShowFishCamera\n    +SetFishingView(FGameplayTag)\n}\n\nclass UActorComponent_FishingComponent {\n    -ICatcherInterface* CurrentCatcher\n    -ICatchableInterface* CurrentCatchable\n    -FGameplayTag CurrentFishingState\n    +OnCastAction(float)\n    +OnCastActionEnded(float)\n    +AttemptToCast(FVector)\n    +AttemptGetNearestCatchable()\n    +ReelInCurrentCatchable()\n}\n\nclass AActor_FishingRod {\n    &lt;&lt;Interface ICatcherInterface&gt;&gt;\n    +UStaticMeshComponent* BobberMeshComponent\n    +Throw(FVector)\n    +ReelBack()\n}\n\nclass AActor_Fish {\n    &lt;&lt;Interface ICatchableInterface&gt;&gt;\n    +ReeledIn(FVector)\n    +Escape()\n    +WanderWithinBoundingBox(float)\n}\n\nclass AActor_FishSpawnArea {\n    +UBoxComponent* SpawnAreaBox\n    +SpawnFishes(...)\n}\n\nclass APlayerController_StairwayFishingGamePlayerController {\n    &lt;&lt;Interface IPlayerActionInputInterface&gt;&gt;\n    +UInputAction* CastingInputAction\n    +OnCastActionStarted()\n    +OnCastActionTriggered()\n    +OnCastActionCompleted()\n}\n\nAPawn_StairwayFishingGame \"1\" -- \"1\" UActorComponent_FishingComponent : contains\nAPlayerController_StairwayFishingGamePlayerController ..&gt; UActorComponent_FishingComponent : provides input\nUActorComponent_FishingComponent ..&gt; AActor_FishingRod : controls\nUActorComponent_FishingComponent ..&gt; AActor_Fish : catches\nAActor_FishSpawnArea ..&gt; AActor_Fish : spawns\n</code></pre> This diagram illustrates the primary classes and their relationships within the fishing system.</p> <p>Sources: Source\\StairwayFishingGameCore\\Public\\PlayerController\\PlayerController_StairwayFishingGamePlayerController.h, Source\\StairwayFishingGameCore\\Private\\Pawn\\Pawn_StairwayFishingGame.cpp, Source\\FishingFeature\\Private\\ActorComponent\\ActorComponent_FishingComponent.cpp, Source\\FishingFeature\\Public\\Actor\\Actor_FishSpawnArea.h</p>"},{"location":"fishing/#key-components","title":"Key Components","text":"Component Description Source File <code>APawn_StairwayFishingGame</code> The player character pawn. It hosts the <code>UActorComponent_FishingComponent</code> and manages the active camera between the main gameplay view and the \"show fish\" view. <code>Pawn/Pawn_StairwayFishingGame.h</code> <code>UActorComponent_FishingComponent</code> The central logic hub for the fishing mechanic. It manages states, handles player input for casting, detects catchable fish, and controls the fishing rod and caught fish. <code>ActorComponent/ActorComponent_FishingComponent.h</code> <code>APlayerController_StairwayFishingGamePlayerController</code> Implements <code>IPlayerActionInputInterface</code> to handle raw input from Unreal's Enhanced Input system. It binds the <code>CastingInputAction</code> and broadcasts delegates for <code>Started</code>, <code>Triggered</code>, and <code>Completed</code> events. <code>PlayerController/PlayerController_StairwayFishingGamePlayerController.h</code> <code>AActor_FishSpawnArea</code> An actor responsible for spawning <code>AActor_Fish</code> instances within a defined <code>UBoxComponent</code> volume at the start of the game. It asynchronously loads the fish asset before spawning. <code>Actor/Actor_FishSpawnArea.h</code> <code>AActor_Fish</code> Represents a catchable fish. It implements the <code>ICatchableInterface</code>, manages its own wandering movement within its spawn area, and handles being reeled in or escaping. <code>Actor/Actor_Fish.h</code> <code>AActor_FishingRod</code> The visual representation of the fishing rod and bobber. It implements the <code>ICatcherInterface</code> and uses timelines to animate the bobber being thrown and reeled back. <code>Actor/Actor_FishingRod.h</code> <code>AGameModeBase_StairwayFishingGame</code> Manages the high-level game loop state transitions. It listens for state change requests and orchestrates screen fades and player input mode changes between \"fishing\" and \"show fish\" states. <code>GameModeBase/GameModeBase_StairwayFishingGame.h</code>"},{"location":"fishing/#gameplay-flow","title":"Gameplay Flow","text":"<p>The fishing process follows a well-defined sequence of events, from game initialization to catching a fish. This flow is managed by the core components and driven by player input and a messaging system.</p>"},{"location":"fishing/#initialization-and-fish-spawning","title":"Initialization and Fish Spawning","text":"<p>When the level starts, the <code>AActor_FishSpawnArea</code> is responsible for populating the water with fish.</p> <p><pre><code>sequenceDiagram\n    participant World\n    participant AActor_FishSpawnArea\n    participant UAssetManager\n    participant ICatchableInterface\n\n    World-&gt;&gt;+AActor_FishSpawnArea: BeginPlay()\n    AActor_FishSpawnArea-&gt;&gt;+UAssetManager: RequestAsyncLoad(FishActorClass)\n    UAssetManager--&gt;&gt;-AActor_FishSpawnArea: OnFishSpawnAssetLoaded()\n    loop For each fish to spawn\n        AActor_FishSpawnArea-&gt;&gt;+World: SpawnActorDeferred&lt;AActor&gt;()\n        World--&gt;&gt;-AActor_FishSpawnArea: SpawnedActor\n        AActor_FishSpawnArea-&gt;&gt;+ICatchableInterface: SetSpawnAreaCenterAndExtent(...)\n        ICatchableInterface--&gt;&gt;-AActor_FishSpawnArea:\n        AActor_FishSpawnArea-&gt;&gt;+World: FinishSpawning()\n        World--&gt;&gt;-AActor_FishSpawnArea:\n    end\n</code></pre> This sequence shows the asynchronous loading and subsequent spawning of fish actors within the defined spawn area. The spawn area provides its bounds to each fish so they can wander within it.</p> <p>Sources: Source\\FishingFeature\\Private\\Actor\\Actor_FishSpawnArea.cpp:32-40, Source\\FishingFeature\\Private\\Actor\\Actor_FishSpawnArea.cpp:66-107</p>"},{"location":"fishing/#the-casting-process","title":"The Casting Process","text":"<p>The casting process begins when the player presses and holds the cast input action. The duration of the hold determines the casting distance.</p> <ol> <li>Input Handling: The <code>APlayerController_StairwayFishingGamePlayerController</code> captures the <code>Started</code>, <code>Triggered</code>, and <code>Completed</code> events from the <code>CastingInputAction</code>. These events are broadcast via delegates.</li> <li>Casting Logic: The <code>UActorComponent_FishingComponent</code> listens to these delegates.<ul> <li>On <code>Started</code>, it begins tracking the cast time and shows a target decal on the water.</li> <li>While <code>Triggered</code> (held down), it continuously updates the cast location based on the elapsed time, mapping it to a min/max distance. A line trace from the calculated position downwards determines the final water surface location.</li> <li>On <code>Completed</code> (released), it triggers the throwing animation and instructs the <code>AActor_FishingRod</code> to throw its bobber.</li> </ul> </li> </ol> <p>Sources: Source\\StairwayFishingGameCore\\Private\\PlayerController\\PlayerController_StairwayFishingGamePlayerController.cpp:45-70, Source\\FishingFeature\\Private\\ActorComponent\\ActorComponent_FishingComponent.cpp:559-620</p> <p><pre><code>sequenceDiagram\n    participant Player\n    participant PlayerController\n    participant FishingComponent\n    participant World\n    participant FishingRod\n\n    Player-&gt;&gt;+PlayerController: Press &amp; Hold Cast Button\n    PlayerController-&gt;&gt;+FishingComponent: OnCastActionStarted()\n    FishingComponent-&gt;&gt;FishingComponent: Start Cast Timer\n    loop While Button Held\n        PlayerController-&gt;&gt;+FishingComponent: OnCastActionTriggered(ElapsedTime)\n        FishingComponent-&gt;&gt;FishingComponent: DetermineCastLocation(ElapsedTime)\n        Note right of FishingComponent: Maps time to distance\n        FishingComponent-&gt;&gt;+World: LineTraceSingleByObjectType()\n        World--&gt;&gt;-FishingComponent: HitResult (Water Location)\n        FishingComponent-&gt;&gt;FishingComponent: Update Decal Position\n        FishingComponent--&gt;&gt;-PlayerController:\n    end\n    Player-&gt;&gt;+PlayerController: Release Cast Button\n    PlayerController-&gt;&gt;+FishingComponent: OnCastActionCompleted()\n    FishingComponent-&gt;&gt;FishingComponent: Set state to Throwing\n    Note right of FishingComponent: Broadcasts Anim State Change Message\n    FishingComponent-&gt;&gt;+FishingRod: Throw(CastLocation)\n    FishingRod--&gt;&gt;-FishingComponent:\n    FishingComponent--&gt;&gt;-PlayerController:\n    PlayerController--&gt;&gt;-Player:\n</code></pre> This diagram details the flow from player input to the bobber being cast into the water.</p> <p>Sources: Source\\FishingFeature\\Private\\ActorComponent\\ActorComponent_FishingComponent.cpp:559-620, Source\\FishingFeature\\Private\\Actor\\Actor_FishingRod.cpp:24-29</p>"},{"location":"fishing/#catching-a-fish","title":"Catching a Fish","text":"<p>Once the bobber lands in the water, the <code>FishingComponent</code> attempts to find a nearby fish.</p> <ol> <li>Bobber Lands: The <code>AActor_FishingRod</code> notifies the <code>FishingComponent</code> via a delegate (<code>OnLandsOnWater</code>) when its throwing timeline is complete.</li> <li>Find Catchable: The <code>FishingComponent</code> performs a sphere trace around the bobber's location to find all actors implementing <code>ICatchableInterface</code>. It sorts these actors by distance and selects the nearest one as <code>CurrentCatchable</code>.</li> <li>Luring the Fish: The <code>FishingComponent</code> calls <code>ReeledIn()</code> on the <code>CurrentCatchable</code> (<code>AActor_Fish</code>). The fish then uses a timeline to move from its current position to the bobber's location.</li> <li>Waiting State: The <code>FishingComponent</code> enters the <code>WaitingForFish</code> state and starts a timer (<code>TimeToFish</code>). If the player does not act before this timer runs out, the fish escapes.</li> <li>Reeling In: If the player presses the cast button again while in the <code>WaitingForFish</code> state, the catch is successful. The component transitions to the <code>Reeling_In</code> state, and a message is sent to the animation system to play the reeling animation.</li> </ol> <p>Sources: Source\\FishingFeature\\Private\\ActorComponent\\ActorComponent_FishingComponent.cpp:457-463, Source\\FishingFeature\\Private\\ActorComponent\\ActorComponent_FishingComponent.cpp:411-455, Source\\FishingFeature\\Private\\Actor\\Actor_Fish.cpp:26-35</p>"},{"location":"fishing/#state-management-and-messaging","title":"State Management and Messaging","text":"<p>The system relies heavily on Gameplay Tags for both internal state management and for communication via a global messaging subsystem.</p>"},{"location":"fishing/#component-state-machine","title":"Component State Machine","text":"<p>The <code>UActorComponent_FishingComponent</code> uses a set of <code>FGameplayTag</code> variables to manage its internal state, ensuring operations occur in the correct sequence.</p> <p><pre><code>graph TD\n    A[Idling] --&gt;|Cast Button Pressed| B(Throwing);\n    B --&gt;|Throw Anim Notify| C(WaitingForFish);\n    C --&gt;|Player Reels In Time| D(Reeling_In);\n    C --&gt;|Timer Expires| E(Reeling_Out);\n    E --&gt;|Reel Anim Done| A;\n    D --&gt;|Reel Anim Done| F(CaughtFish);\n    F --&gt;|State Change to Fishing| A;\n</code></pre> This state diagram shows the primary states of the <code>FishingComponent</code> and the transitions between them.</p> <p>Sources: Source\\FishingGameplayTags\\Private\\FishingTags.cpp:21-26, Source\\FishingFeature\\Private\\ActorComponent\\ActorComponent_FishingComponent.cpp</p>"},{"location":"fishing/#messaging-system","title":"Messaging System","text":"<p>Decoupled communication is achieved using <code>UVAGameplayMessagingSubsystem</code>. Components can broadcast messages on specific <code>FGameplayTag</code> channels, and other components can create listeners for those channels without needing direct references.</p> <p>Key Messaging Channels:</p> Channel Tag Payload Type Description <code>Messaging.Fishing.UI.Cast.Update</code> <code>float</code> Broadcasts the current charge of the cast (0.0 to 1.0) for UI elements like a power bar. <code>Messaging.Fishing.AnimInstance.StateChange</code> <code>FGameplayTag</code> Sent to the Animation Blueprint to switch between animation states (e.g., <code>Idling</code>, <code>Throwing</code>, <code>Reeling_In</code>). <code>Messaging.GameState.StateChange</code> <code>FGameplayTag</code> Broadcast when a high-level game state change is required, such as from <code>Fishing</code> to <code>ShowFish</code>. This is received by the <code>GameState</code>. <code>Messaging.GameMode.StateChange.Finish</code> <code>FGameplayTag</code> Broadcast by the <code>GameMode</code> after its state transition (including screen fade) is complete. The <code>FishingComponent</code> listens for this to finalize the catch. <code>Messaging.Fishing.Notify.Throw</code> Empty An animation notify that signals the exact moment in an animation the bobber should be thrown. The <code>FishingComponent</code> listens for this. <code>Messaging.Fishing.Notify.ReelDone</code> Empty An animation notify that signals the reeling animation has finished. <p>Sources: Source\\FishingGameplayTags\\Private\\FishingTags.cpp:7-15, Source\\VAGameplayMessaging\\Private\\GameInstanceSubsystem\\VAGameplayMessagingSubsystem.cpp, Source\\FishingFeature\\Private\\ActorComponent\\ActorComponent_FishingComponent.cpp:65-75</p> <p>The <code>VAGameplayMessagingSubsystem</code> uses a <code>TMap&lt;FGameplayTag, FChannelMembersData&gt;</code> to keep track of all active listeners for each channel. When a message is broadcast, it looks up the channel tag in the map and iterates through the list of listeners, invoking their <code>OnGameplayMessageReceived</code> delegate.</p> <p>Sources: Source\\VAGameplayMessaging\\Private\\GameInstanceSubsystem\\VAGameplayMessagingSubsystem.cpp:77-113</p>"},{"location":"fishing/#configuration-via-data-assets","title":"Configuration via Data Assets","text":"<p>The fishing system is highly configurable through the use of <code>UDataAsset</code>. This allows designers to tweak gameplay parameters without modifying code.</p> <ul> <li><code>DataAsset_FishingComponentConfig</code>: Configures the core fishing mechanics.<ul> <li><code>MaximumTimeToCast</code>: How long the player can hold the button to charge a cast.</li> <li><code>MinimumCastDistance</code> / <code>MaximumCastDistance</code>: The range of the cast distance.</li> <li><code>CastRadius</code>: The radius of the sphere trace used to find fish.</li> <li><code>TimeToFish</code>: The window of time the player has to reel in a fish after it bites.</li> <li><code>FishingRodActorClass</code>: A soft reference to the <code>AActor_FishingRod</code> blueprint to spawn.</li> </ul> </li> <li><code>DataAsset_ActorFishConfig</code>: Configures the behavior of an individual fish.<ul> <li><code>FishRotationSpeed</code> / <code>FishMoveSpeed</code>: Controls the speed of the fish's wandering movement.</li> <li><code>FishReelingInCurve</code>: A <code>UCurveFloat</code> that defines the fish's movement as it's lured to the bobber.</li> <li><code>FishBiteSound</code>: The sound to play when the fish is successfully caught.</li> </ul> </li> <li><code>DataAsset_FishSpawnAreaConfig</code>: Configures the fish spawning logic.<ul> <li><code>FishActorClass</code>: A soft reference to the <code>AActor_Fish</code> blueprint to spawn.</li> <li><code>FishSpawnAmount</code>: The number of fish to spawn in the area.</li> </ul> </li> <li><code>DataAsset_FishingRodConfig</code>: Configures the fishing rod's animations.<ul> <li><code>BobberReelInCurve</code>: A <code>UCurveFloat</code> defining the bobber's trajectory when thrown.</li> <li><code>BobberReelOutCurve</code>: A <code>UCurveFloat</code> defining the bobber's movement when reeled back.</li> </ul> </li> </ul>"},{"location":"fishing/#editor-enhancements","title":"Editor Enhancements","text":"<p>To improve the workflow for designers, a custom details panel customization is implemented for the <code>UActorComponent_FishingComponent</code>.</p> <p>The <code>FDetailCustomization_FishingComponent</code> class provides a user-friendly dropdown menu for selecting socket names (<code>FishingPoleSocketName</code>, <code>CarryFishSocketName</code>) in the editor. Instead of requiring designers to manually type in socket names, this customization inspects the <code>OwnerSkeletalMesh</code> property within the component's configuration. It then populates a <code>SComboBox</code> with all available bone and socket names from that mesh, preventing typos and making setup much faster and more reliable. The dropdown is automatically updated whenever the assigned <code>SkeletalMesh</code> is changed.</p> <p>Sources: Source\\FishingFeatureEditor\\Private\\DetailCustomization\\DetailCustomization_FishingComponent.cpp:70-149</p> <p></p>"},{"location":"fishing/#module-overview","title":"Module Overview","text":""},{"location":"fishing/#related-pages_2","title":"Related Pages","text":"<p>Related topics: Core Gameplay Classes, Messaging System (VAGameplayMessaging)</p> Relevant source files  The following files were used as context for generating this wiki page:  - [Source/StairwayFishingGameCore/Private/GameModeBase/GameModeBase_StairwayFishingGame.cpp](https://github.com/rezonated/Unreal-Fishing-Test/blob/main/Source/StairwayFishingGameCore/Private/GameModeBase/GameModeBase_StairwayFishingGame.cpp) - [Source/FishingFeature/Private/ActorComponent/ActorComponent_FishingComponent.cpp](https://github.com/rezonated/Unreal-Fishing-Test/blob/main/Source/FishingFeature/Private/ActorComponent/ActorComponent_FishingComponent.cpp) - [Source/VAGameplayMessaging/Private/GameInstanceSubsystem/VAGameplayMessagingSubsystem.cpp](https://github.com/rezonated/Unreal-Fishing-Test/blob/main/Source/VAGameplayMessaging/Private/GameInstanceSubsystem/VAGameplayMessagingSubsystem.cpp) - [Source/StairwayFishingGameCore/Private/GameStateBase/GameStateBase_StairwayFishingGame.cpp](https://github.com/rezonated/Unreal-Fishing-Test/blob/main/Source/StairwayFishingGameCore/Private/GameStateBase/GameStateBase_StairwayFishingGame.cpp) - [Source/StairwayFishingGameCore/Private/PlayerController/PlayerController_StairwayFishingGamePlayerController.cpp](https://github.com/rezonated/Unreal-Fishing-Test/blob/main/Source/StairwayFishingGameCore/Private/PlayerController/PlayerController_StairwayFishingGamePlayerController.cpp) - [Source/FishingGameplayTags/Public/FishingTags.h](https://github.com/rezonated/Unreal-Fishing-Test/blob/main/Source/FishingGameplayTags/Public/FishingTags.h) - [Source/FishingFeature/Private/Actor/Actor_Fish.cpp](https://github.com/rezonated/Unreal-Fishing-Test/blob/main/Source/FishingFeature/Private/Actor/Actor_Fish.cpp) - [Source/FishingFeature/Private/Actor/Actor_FishingRod.cpp](https://github.com/rezonated/Unreal-Fishing-Test/blob/main/Source/FishingFeature/Private/Actor/Actor_FishingRod.cpp) - [Source/StairwayFishingGameCore/Private/Pawn/Pawn_StairwayFishingGame.cpp](https://github.com/rezonated/Unreal-Fishing-Test/blob/main/Source/StairwayFishingGameCore/Private/Pawn/Pawn_StairwayFishingGame.cpp) - [Source/FishingFeatureEditor/Private/DetailCustomization/DetailCustomization_FishingComponent.cpp](https://github.com/rezonated/Unreal-Fishing-Test/blob/main/Source/FishingFeatureEditor/Private/DetailCustomization/DetailCustomization_FishingComponent.cpp)"},{"location":"fishing/#module-overview_1","title":"Module Overview","text":"<p>This document provides a technical overview of the Unreal-Fishing-Test project, a modular fishing game system built in Unreal Engine. The architecture is designed to be event-driven and decoupled, separating the core gameplay logic, the fishing feature itself, and the messaging system into distinct modules. This separation facilitates maintenance, testing, and potential expansion of features.</p> <p>The system's backbone is a custom gameplay messaging subsystem, <code>VAGameplayMessagingSubsystem</code>, which uses <code>FGameplayTag</code> channels for communication. This allows various components, such as the <code>PlayerController</code>, <code>FishingComponent</code>, and <code>GameMode</code>, to interact without direct dependencies. The core gameplay loop is managed through a state machine implemented across the <code>GameState</code> and <code>GameMode</code>, transitioning the player between fishing and displaying the catch.</p>"},{"location":"fishing/#core-modules","title":"Core Modules","text":"<p>The project is structured into several key modules, each with a specific responsibility.</p> Module Responsibility <code>StairwayFishingGameCore</code> Manages the main game loop, player pawn, controller, game mode, and game state. <code>FishingFeature</code> Contains all logic and assets for the fishing mechanic, including the fishing component, rod, fish, and spawn areas. <code>VAGameplayMessaging</code> Provides a global, event-driven messaging system for decoupled communication between modules. <code>FishingGameplayTags</code> Defines and registers all <code>FGameplayTag</code> constants used for messaging and state management. <code>FishingFeatureEditor</code> Implements Unreal Editor customizations to improve the development workflow, such as custom details panels."},{"location":"fishing/#module-dependency-diagram","title":"Module Dependency Diagram","text":"<p>The following diagram illustrates the dependencies between the primary modules. The core game logic depends on the fishing feature and the messaging system, while the feature itself also relies on messaging to communicate events.</p> <p><pre><code>graph TD\n    subgraph Application\n        StairwayFishingGameCore\n        FishingFeature\n        VAGameplayMessaging\n    end\n\n    subgraph Editor\n        FishingFeatureEditor\n    end\n\n    StairwayFishingGameCore --&gt; FishingFeature\n    StairwayFishingGameCore --&gt; VAGameplayMessaging\n    FishingFeature --&gt; VAGameplayMessaging\n    FishingFeatureEditor --&gt; FishingFeature\n</code></pre> Sources: StairwayFishingGameCore/StairwayFishingGameCore.Build.cs, FishingFeature/FishingFeature.Build.cs, VAGameplayMessaging/VAGameplayMessaging.Build.cs</p>"},{"location":"fishing/#gameplay-flow-and-state-management","title":"Gameplay Flow and State Management","text":"<p>The primary gameplay loop is managed by a state machine pattern distributed between <code>AGameStateBase_StairwayFishingGame</code> and <code>AGameModeBase_StairwayFishingGame</code>.</p>"},{"location":"fishing/#state-management","title":"State Management","text":"<ul> <li> <p><code>AGameStateBase_StairwayFishingGame</code>: This class is responsible for maintaining the current state of the game loop, stored in the <code>CurrentFishingGameLoopState</code> property. It listens for state change requests on the <code>Messaging_GameState_StateChange</code> channel. When a new state is received, it updates its internal state and broadcasts the change via its <code>OnFishingGameLoopStateChanged</code> delegate.     Sources: Source/StairwayFishingGameCore/Public/GameStateBase/GameStateBase_StairwayFishingGame.h:35, Source/StairwayFishingGameCore/Private/GameStateBase/GameStateBase_StairwayFishingGame.cpp:15-19</p> </li> <li> <p><code>AGameModeBase_StairwayFishingGame</code>: The game mode listens to the <code>GameState</code>'s <code>OnFishingGameLoopStateChanged</code> delegate. Upon a state change, it orchestrates the necessary transitions, such as triggering camera fades, changing player input modes (e.g., from <code>FInputModeGameOnly</code> to <code>FInputModeUIOnly</code>), and instructing the player pawn to switch cameras via the <code>ISwitchableFishingViewInterface</code>.     Sources: Source/StairwayFishingGameCore/Private/GameModeBase/GameModeBase_StairwayFishingGame.cpp:18-80</p> </li> </ul>"},{"location":"fishing/#gameplay-sequence-diagram","title":"Gameplay Sequence Diagram","text":"<p>This diagram illustrates the complete sequence of events from casting the line to catching a fish and transitioning to the \"Show Fish\" view.</p> <p><pre><code>sequenceDiagram\n    participant Player as actor\n    participant PC as PlayerController\n    participant FC as FishingComponent\n    participant FR as FishingRod\n    participant Fish as FishActor\n    participant GS as GameState\n    participant GM as GameMode\n    participant Pawn\n\n    Player-&gt;&gt;+PC: Press/Hold Cast Action\n    PC-&gt;&gt;FC: OnCastActionTriggered()\n    FC-&gt;&gt;FC: Calculate Cast Distance\n    Player-&gt;&gt;-PC: Release Cast Action\n    PC-&gt;&gt;FC: OnCastActionCompleted()\n    FC-&gt;&gt;VAGameplayMessaging: Broadcast(AnimInstance_State_Throwing)\n    Note over FC: Anim BP triggers \"Throw\" notify\n\n    VAGameplayMessaging--&gt;&gt;FC: OnThrowNotifyMessageReceived()\n    FC-&gt;&gt;+FR: Throw(CastLocation)\n    FR--&gt;&gt;-FC: CatchableLandsOnWaterDelegate.Execute()\n    FC-&gt;&gt;FC: Find nearest Fish\n    FC-&gt;&gt;+Fish: ReeledIn(RodLocation)\n    Fish--&gt;&gt;-FC: (Fish moves to bobber)\n\n    Player-&gt;&gt;+PC: Press Cast Action (to reel)\n    PC-&gt;&gt;FC: OnCastActionCompleted()\n    FC-&gt;&gt;FR: ReelBack()\n    FC-&gt;&gt;VAGameplayMessaging: Broadcast(AnimInstance_State_Reeling_In)\n    Note over FC: Anim BP triggers \"ReelDone\" notify\n\n    VAGameplayMessaging--&gt;&gt;FC: OnReelDoneNotifyMessageReceived()\n    FC-&gt;&gt;VAGameplayMessaging: Broadcast(GameState_StateChange, \"ShowFish\")\n\n    VAGameplayMessaging--&gt;&gt;+GS: OnGameStateChangeMessageReceived()\n    GS-&gt;&gt;GS: SetCurrentFishingGameLoopState(\"ShowFish\")\n    GS-&gt;&gt;+GM: OnFishingGameLoopStateChanged.Broadcast()\n    GM-&gt;&gt;GM: TriggerScreenFadeInOut()\n    GM-&gt;&gt;+Pawn: SetFishingView(\"ShowFish\")\n    Pawn--&gt;&gt;-Pawn: Switch to ShowFishCamera\n    GM--&gt;&gt;-GS: (Transition logic)\n    GM-&gt;&gt;VAGameplayMessaging: Broadcast(GameMode_StateChangeFinish)\n\n    VAGameplayMessaging--&gt;&gt;FC: OnGameModeStateChangeFinishMessageReceived()\n    FC-&gt;&gt;FC: Attach fish to player socket\n</code></pre> Sources: Source/StairwayFishingGameCore/Private/PlayerController/PlayerController_StairwayFishingGamePlayerController.cpp:78-83, Source/FishingFeature/Private/ActorComponent/ActorComponent_FishingComponent.cpp:751-766, 819-835, Source/StairwayFishingGameCore/Private/GameStateBase/GameStateBase_StairwayFishingGame.cpp:46-59, Source/StairwayFishingGameCore/Private/GameModeBase/GameModeBase_StairwayFishingGame.cpp:18-80</p>"},{"location":"fishing/#event-driven-communication","title":"Event-Driven Communication","text":"<p>The project heavily relies on the <code>UVAGameplayMessagingSubsystem</code> for decoupled communication. This system allows any object to broadcast a message on a specific <code>FGameplayTag</code> channel, and any other object to listen for messages on that channel without needing a direct reference.</p> <ul> <li>Broadcasting: Messages are sent using <code>UVAGameplayMessagingSubsystem::BroadcastMessage</code>. The payload can be any struct wrapped in the <code>FVAAnyUnreal</code> type, which allows for flexible data transfer.     Sources: Source/VAGameplayMessaging/Private/GameInstanceSubsystem/VAGameplayMessagingSubsystem.cpp:52-65</li> <li>Listening: Listeners are created using the async action <code>UVAGameplayMessaging_ListenForGameplayMessages::ListenForGameplayMessagesViaChannel</code>. This node registers itself with the subsystem and exposes a delegate (<code>OnGameplayMessageReceived</code>) that fires when a message is broadcast on the subscribed channel.     Sources: Source/FishingFeature/Private/ActorComponent/ActorComponent_FishingComponent.cpp:61-65, Source/VAGameplayMessaging/Private/GameInstanceSubsystem/VAGameplayMessagingSubsystem.cpp:131-168</li> </ul>"},{"location":"fishing/#key-gameplay-tags","title":"Key Gameplay Tags","text":"<p>Gameplay Tags are central to the messaging system, defining channels for events and states.</p> Tag Category Tag Name Purpose <code>Messaging.Fishing</code> <code>UI.Cast.Update</code> Sends updates to the UI about the casting power meter. <code>Messaging.Fishing</code> <code>Notify.Throw</code> Fired by an animation notify to signal the moment to throw the line. <code>Messaging.Fishing</code> <code>Notify.ReelDone</code> Fired by an animation notify when the reeling animation is complete. <code>Messaging.Fishing</code> <code>AnimInstance.StateChange</code> Instructs the character's Animation Blueprint to switch states. <code>Messaging.GameState</code> <code>StateChange</code> Requests a change in the global game loop state (e.g., to \"ShowFish\"). <code>Messaging.GameMode</code> <code>StateChange.Finish</code> Signals that the GameMode has completed its state transition logic. <code>FishingGameLoopState</code> <code>Fishing</code> / <code>ShowFish</code> Defines the primary states of the game loop. <code>FishingComponent.State</code> <code>Idling</code>, <code>Throwing</code>, etc. Defines the internal states of the <code>FishingComponent</code>. <code>AnimInstance.Fishing</code> <code>Idling</code>, <code>Throwing</code>, etc. Defines animation states for the character's animation blueprint. <p>Sources: Source/FishingGameplayTags/Public/FishingTags.h, Source/FishingGameplayTags/Private/FishingTags.cpp</p>"},{"location":"fishing/#fishing-mechanic-implementation","title":"Fishing Mechanic Implementation","text":"<p>The <code>FishingFeature</code> module encapsulates all components related to the act of fishing.</p>"},{"location":"fishing/#class-relationship-diagram","title":"Class Relationship Diagram","text":"<p>This diagram shows the main classes within the <code>FishingFeature</code> module and their relationships.</p> <pre><code>classDiagram\n    direction TD\n    class APawn_StairwayFishingGame {\n        +UActorComponent_FishingComponent* FishingComponent\n    }\n    class UActorComponent_FishingComponent {\n        -ICatcherInterface* CurrentCatcher\n        -ICatchableInterface* CurrentCatchable\n        +OnCastActionStarted()\n        +OnCastActionCompleted()\n        +Throw()\n        +ReelBack()\n    }\n    class AActor_FishingRod {\n        &lt;&lt;Interface&gt;&gt;\n        ICatcherInterface\n        +Throw(FVector InCastLocation)\n        +ReelBack()\n    }\n    class AActor_Fish {\n        &lt;&lt;Interface&gt;&gt;\n        ICatchableInterface\n        +ReeledIn(FVector RodLocation)\n        +Escape()\n    }\n    class AActor_FishSpawnArea {\n        +SpawnFishes()\n    }\n\n    APawn_StairwayFishingGame \"1\" --o \"1\" UActorComponent_FishingComponent : hosts\n    UActorComponent_FishingComponent ..&gt; ICatcherInterface : uses\n    UActorComponent_FishingComponent ..&gt; ICatchableInterface : uses\n    AActor_FishingRod --|&gt; ICatcherInterface : implements\n    AActor_Fish --|&gt; ICatchableInterface : implements\n    AActor_FishSpawnArea ..&gt; AActor_Fish : spawns\n</code></pre>"},{"location":"fishing/#core-components","title":"Core Components","text":"<ul> <li> <p><code>UActorComponent_FishingComponent</code>: This is the brain of the fishing system. Attached to the player pawn, it manages the fishing state machine (<code>Idling</code>, <code>Throwing</code>, <code>WaitingForFish</code>, etc.). It binds to player input delegates from the <code>PlayerController</code>, handles the logic for casting distance, detects nearby fish using sphere traces, and orchestrates interactions between the fishing rod (<code>ICatcherInterface</code>) and the fish (<code>ICatchableInterface</code>).     Sources: Source/FishingFeature/Private/ActorComponent/ActorComponent_FishingComponent.cpp</p> </li> <li> <p><code>AActor_FishingRod</code>: Implements the <code>ICatcherInterface</code>. This actor represents the physical fishing rod and bobber. It uses <code>FTimeline</code> components driven by <code>UCurveFloat</code> assets to create smooth, data-driven animations for casting out (<code>Throw</code>) and reeling back (<code>ReelBack</code>) the bobber.     Sources: Source/FishingFeature/Private/Actor/Actor_FishingRod.cpp:27-40, 94-113</p> </li> <li> <p><code>AActor_Fish</code>: Implements the <code>ICatchableInterface</code>. Each fish is an autonomous actor that wanders within its spawn area. It uses timelines to handle its movement when it is being reeled in or when it escapes.     Sources: Source/FishingFeature/Private/Actor/Actor_Fish.cpp:24-41, 117-133</p> </li> <li> <p><code>AActor_FishSpawnArea</code>: This actor defines a volume (<code>UBoxComponent</code>) where fish can be spawned. It asynchronously loads the fish actor class using <code>UAssetManager</code> and then spawns a configured number of fish at random points within its bounds.     Sources: Source/FishingFeature/Public/Actor/Actor_FishSpawnArea.h:21-26, Source/FishingFeature/Private/Actor/Actor_FishSpawnArea.cpp:23-32, 79-116</p> </li> </ul>"},{"location":"fishing/#input-handling_1","title":"Input Handling","text":"<p>Player input is managed by Unreal Engine's Enhanced Input system.</p> <ul> <li><code>APlayerController_StairwayFishingGamePlayerController</code>: This class is responsible for setting up the input mapping context and binding to input actions. It defines a <code>CastingInputAction</code> which is bound to <code>Started</code>, <code>Triggered</code>, and <code>Completed</code> events.</li> <li>Delegates: Instead of directly handling logic, the Player Controller exposes delegates (<code>OnCastActionStarted</code>, <code>OnCastActionTriggered</code>, <code>OnCastActionCompleted</code>). Other systems, like the <code>UActorComponent_FishingComponent</code>, can bind to these delegates to receive input events. This decouples the input source from the gameplay logic.</li> </ul> <p>Sources: Source/StairwayFishingGameCore/Public/PlayerController/PlayerController_StairwayFishingGamePlayerController.h:25-35, Source/StairwayFishingGameCore/Private/PlayerController/PlayerController_StairwayFishingGamePlayerController.cpp:56-71</p>"},{"location":"fishing/#editor-customization","title":"Editor Customization","text":"<p>To enhance the developer experience, the project includes an editor module, <code>FishingFeatureEditor</code>.</p> <ul> <li><code>FDetailCustomization_FishingComponent</code>: This class provides a custom details panel UI for the <code>FFishingComponentConfig</code> struct within the <code>UActorComponent_FishingComponent</code>. It replaces the default <code>FName</code> text fields for socket names (<code>FishingPoleSocketName</code>, <code>CarryFishSocketName</code>) with a dropdown combo box. This combo box is dynamically populated with all available bone and socket names from the <code>USkeletalMesh</code> assigned in the config, reducing errors from typos and making configuration faster and more intuitive.     Sources: Source/FishingFeatureEditor/Private/DetailCustomization/DetailCustomization_FishingComponent.cpp:16-52, 73-138</li> </ul> <p></p>"},{"location":"fishing/#core-gameplay-classes","title":"Core Gameplay Classes","text":""},{"location":"fishing/#related-pages_3","title":"Related Pages","text":"<p>Related topics: Module Overview, Fishing Gameplay Loop</p> Relevant source files  The following files were used as context for generating this wiki page:  - [Source/StairwayFishingGameCore/Public/GameModeBase/GameModeBase_StairwayFishingGame.h](https://github.com/rezonated/Unreal-Fishing-Test/blob/main/Source/StairwayFishingGameCore/Public/GameModeBase/GameModeBase_StairwayFishingGame.h) - [Source/StairwayFishingGameCore/Private/GameModeBase/GameModeBase_StairwayFishingGame.cpp](https://github.com/rezonated/Unreal-Fishing-Test/blob/main/Source/StairwayFishingGameCore/Private/GameModeBase/GameModeBase_StairwayFishingGame.cpp) - [Source/StairwayFishingGameCore/Public/GameStateBase/GameStateBase_StairwayFishingGame.h](https://github.com/rezonated/Unreal-Fishing-Test/blob/main/Source/StairwayFishingGameCore/Public/GameStateBase/GameStateBase_StairwayFishingGame.h) - [Source/StairwayFishingGameCore/Private/GameStateBase/GameStateBase_StairwayFishingGame.cpp](https://github.com/rezonated/Unreal-Fishing-Test/blob/main/Source/StairwayFishingGameCore/Private/GameStateBase/GameStateBase_StairwayFishingGame.cpp) - [Source/StairwayFishingGameCore/Public/PlayerController/PlayerController_StairwayFishingGamePlayerController.h](https://github.com/rezonated/Unreal-Fishing-Test/blob/main/Source/StairwayFishingGameCore/Public/PlayerController/PlayerController_StairwayFishingGamePlayerController.h) - [Source/StairwayFishingGameCore/Private/PlayerController/PlayerController_StairwayFishingGamePlayerController.cpp](https://github.com/rezonated/Unreal-Fishing-Test/blob/main/Source/StairwayFishingGameCore/Private/PlayerController/PlayerController_StairwayFishingGamePlayerController.cpp) - [Source/StairwayFishingGameCore/Public/Pawn/Pawn_StairwayFishingGame.h](https://github.com/rezonated/Unreal-Fishing-Test/blob/main/Source/StairwayFishingGameCore/Public/Pawn/Pawn_StairwayFishingGame.h) - [Source/StairwayFishingGameCore/Private/Pawn/Pawn_StairwayFishingGame.cpp](https://github.com/rezonated/Unreal-Fishing-Test/blob/main/Source/StairwayFishingGameCore/Private/Pawn/Pawn_StairwayFishingGame.cpp) - [Source/FishingFeature/Private/ActorComponent/ActorComponent_FishingComponent.cpp](https://github.com/rezonated/Unreal-Fishing-Test/blob/main/Source/FishingFeature/Private/ActorComponent/ActorComponent_FishingComponent.cpp) - [Source/VAGameplayMessaging/Private/GameInstanceSubsystem/VAGameplayMessagingSubsystem.cpp](https://github.com/rezonated/Unreal-Fishing-Test/blob/main/Source/VAGameplayMessaging/Private/GameInstanceSubsystem/VAGameplayMessagingSubsystem.cpp) - [Source/FishingGameplayTags/Public/FishingTags.h](https://github.com/rezonated/Unreal-Fishing-Test/blob/main/Source/FishingGameplayTags/Public/FishingTags.h)"},{"location":"fishing/#core-gameplay-classes_1","title":"Core Gameplay Classes","text":"<p>The core gameplay classes form the foundational structure of the Stairway Fishing Game, adhering to the standard Unreal Engine gameplay framework. This system is composed of four main classes: <code>AGameModeBase_StairwayFishingGame</code>, <code>AGameStateBase_StairwayFishingGame</code>, <code>APlayerController_StairwayFishingGamePlayerController</code>, and <code>APawn_StairwayFishingGame</code>. Together, they manage the game's rules, state, player input, and the player's representation in the world.</p> <p>The architecture is event-driven, primarily using the <code>VAGameplayMessagingSubsystem</code> to communicate state changes between classes. The <code>GameState</code> acts as the central authority for the current game loop state, while the <code>GameMode</code> observes these changes and orchestrates transitions, such as camera fades and view switching on the <code>Pawn</code>. The <code>PlayerController</code> is dedicated to handling raw player input via the Enhanced Input system and broadcasting it to interested listeners, like the <code>FishingComponent</code> on the Pawn.</p>"},{"location":"fishing/#system-architecture-overview","title":"System Architecture Overview","text":"<p>The following diagram illustrates the primary relationships and dependencies between the core gameplay classes.</p> <p><pre><code>classDiagram\ndirection TD\n    class AGameModeBase {\n        &lt;&lt;Unreal&gt;&gt;\n    }\n    class AGameStateBase {\n        &lt;&lt;Unreal&gt;&gt;\n    }\n    class APlayerController {\n        &lt;&lt;Unreal&gt;&gt;\n    }\n    class APawn {\n        &lt;&lt;Unreal&gt;&gt;\n    }\n    class IPlayerActionInputInterface {\n        &lt;&lt;Interface&gt;&gt;\n        +OnCastActionStarted() FOnPlayerActionInput&amp;\n        +OnCastActionTriggered() FOnPlayerActionInput&amp;\n        +OnCastActionCompleted() FOnPlayerActionInput&amp;\n    }\n    class ISwitchableFishingViewInterface {\n        &lt;&lt;Interface&gt;&gt;\n        +SetFishingView(FGameplayTag)\n    }\n    class UActorComponent_FishingComponent {\n        &lt;&lt;Component&gt;&gt;\n    }\n\n    AGameModeBase &lt;|-- AGameModeBase_StairwayFishingGame\n    AGameStateBase &lt;|-- AGameStateBase_StairwayFishingGame\n    APlayerController &lt;|-- APlayerController_StairwayFishingGamePlayerController\n    APawn &lt;|-- APawn_StairwayFishingGame\n\n    APlayerController_StairwayFishingGamePlayerController ..|&gt; IPlayerActionInputInterface\n    APawn_StairwayFishingGame ..|&gt; ISwitchableFishingViewInterface\n\n    AGameModeBase_StairwayFishingGame o-- AGameStateBase_StairwayFishingGame : \"Listens to\"\n    AGameModeBase_StairwayFishingGame o-- APawn_StairwayFishingGame : \"Calls SetFishingView on\"\n    AGameModeBase_StairwayFishingGame o-- APlayerController_StairwayFishingGamePlayerController : \"Toggles Input Mode\"\n\n    APawn_StairwayFishingGame \"1\" *-- \"1\" UActorComponent_FishingComponent : \"Contains\"\n    UActorComponent_FishingComponent o-- APlayerController_StairwayFishingGamePlayerController : \"Binds to delegates\"\n</code></pre> This diagram shows the inheritance from base Unreal classes and the key interactions. The <code>GameMode</code> listens to the <code>GameState</code> and directs the <code>Pawn</code> and <code>PlayerController</code> during state transitions. The <code>Pawn</code> implements the view-switching logic and contains the core <code>FishingComponent</code>, which in turn binds to input delegates from the <code>PlayerController</code>.</p> <p>Sources: Source/StairwayFishingGameCore/Public/Pawn/Pawn_StairwayFishingGame.h:20, Source/StairwayFishingGameCore/Public/PlayerController/PlayerController_StairwayFishingGamePlayerController.h:17, Source/StairwayFishingGameCore/Public/GameModeBase/GameModeBase_StairwayFishingGame.h:46, Source/FishingFeature/Private/ActorComponent/ActorComponent_FishingComponent.cpp:142-152</p>"},{"location":"fishing/#agamestatebase_stairwayfishinggame","title":"<code>AGameStateBase_StairwayFishingGame</code>","text":"<p>The <code>AGameStateBase_StairwayFishingGame</code> class is the authority on the current state of the game loop. Its primary role is to hold and manage the <code>CurrentFishingGameLoopState</code> as an <code>FGameplayTag</code>.</p>"},{"location":"fishing/#state-management_1","title":"State Management","text":"<p>The game state listens for messages on the <code>Messaging_GameState_StateChange</code> channel. When a message containing a new <code>FGameplayTag</code> is received, it updates its internal state and broadcasts the change via the <code>OnFishingGameLoopStateChanged</code> delegate. This decoupling allows any system to request a state change without needing a direct reference to the <code>GameState</code> or its observers.</p> <p>In <code>BeginPlay</code>, it sets up an asynchronous listener for the state change message channel. <pre><code>// Source/StairwayFishingGameCore/Private/GameStateBase/GameStateBase_StairwayFishingGame.cpp:24-29\nvoid AGameStateBase_StairwayFishingGame::BeginPlay()\n{\n    Super::BeginPlay();\n\n    GameStateChangeMessageListenerAsync = UVAGameplayMessaging_ListenForGameplayMessages::ListenForGameplayMessagesViaChannel(this, FFishingTags::Get().Messaging_GameState_StateChange);\n\n    GameStateChangeMessageListenerAsync-&gt;OnGameplayMessageReceived.AddUniqueDynamic(\n        this, &amp;ThisClass::OnGameStateChangeMessageReceived);\n\n    GameStateChangeMessageListenerAsync-&gt;Activate();\n}\n</code></pre></p> <p>When a message is received, <code>OnGameStateChangeMessageReceived</code> validates the payload and calls <code>SetCurrentFishingGameLoopState</code>, which triggers the broadcast.</p> <p>Sources: Source/StairwayFishingGameCore/Public/GameStateBase/GameStateBase_StairwayFishingGame.h, Source/StairwayFishingGameCore/Private/GameStateBase/GameStateBase_StairwayFishingGame.cpp</p>"},{"location":"fishing/#agamemodebase_stairwayfishinggame","title":"<code>AGameModeBase_StairwayFishingGame</code>","text":"<p>The <code>AGameModeBase_StairwayFishingGame</code> orchestrates high-level game flow based on state changes from the <code>AGameStateBase</code>. It is responsible for managing visual transitions and player input modes.</p>"},{"location":"fishing/#responding-to-state-changes","title":"Responding to State Changes","text":"<p>Upon <code>BeginPlay</code>, the <code>GameMode</code> finds the <code>GameState</code> and binds its <code>OnFishingGameLoopStateChanged</code> method to the <code>GameState</code>'s delegate. When this event fires, the <code>GameMode</code> executes a series of actions to transition the game smoothly.</p> <p>The core transition logic involves: 1.  Determining if the new state is for fishing (<code>FishingGameLoopState_Fishing</code>) or not. 2.  Toggling the <code>PlayerController</code>'s input mode between <code>FInputModeGameOnly</code> and <code>FInputModeUIOnly</code>, and showing/hiding the mouse cursor accordingly. 3.  Triggering a screen fade-out, switching the camera view on the possessed <code>Pawn</code>, and then fading back in.</p> <p>This entire sequence is initiated within <code>OnFishingGameLoopStateChanged</code>.</p> <p>Sources: Source/StairwayFishingGameCore/Private/GameModeBase/GameModeBase_StairwayFishingGame.cpp:18-80</p>"},{"location":"fishing/#state-transition-flow","title":"State Transition Flow","text":"<p>The following diagram illustrates the sequence of events when the game state changes.</p> <p><pre><code>sequenceDiagram\n    participant System as External System\n    participant Messaging as VAGameplayMessagingSubsystem\n    participant GameState as AGameStateBase_StairwayFishingGame\n    participant GameMode as AGameModeBase_StairwayFishingGame\n    participant PC as APlayerController\n    participant Pawn as APawn_StairwayFishingGame\n\n    System-&gt;&gt;+Messaging: BroadcastMessage('Messaging.GameState.StateChange', NewStateTag)\n    Messaging-&gt;&gt;+GameState: OnGameStateChangeMessageReceived(NewStateTag)\n    GameState-&gt;&gt;GameState: SetCurrentFishingGameLoopState(NewStateTag)\n    GameState-&gt;&gt;-GameState: Broadcast(OnFishingGameLoopStateChanged)\n    Messaging--&gt;&gt;-System: \n\n    Note over GameState, GameMode: GameMode has previously bound to this delegate.\n\n    GameState-&gt;&gt;+GameMode: OnFishingGameLoopStateChanged(NewStateTag)\n    GameMode-&gt;&gt;+PC: TogglePlayerControllerMode()\n    PC-&gt;&gt;PC: SetInputMode()\n    PC-&gt;&gt;PC: SetShowMouseCursor()\n    PC--&gt;&gt;-GameMode: \n\n    GameMode-&gt;&gt;GameMode: TriggerScreenFadeInOut()\n    Note right of GameMode: Starts a camera fade-out.\n\n    loop After Fade-In Delay\n        GameMode-&gt;&gt;+Pawn: SetFishingView(NewStateTag)\n        Pawn-&gt;&gt;Pawn: SetActive(Camera)\n        Pawn-&gt;&gt;Pawn: SetActive(ShowFishCamera)\n        Pawn--&gt;&gt;-GameMode: \n\n        GameMode-&gt;&gt;+Messaging: BroadcastMessage('Messaging.GameMode.StateChange.Finish')\n        Messaging--&gt;&gt;-GameMode: \n        Note right of GameMode: Starts a camera fade-in.\n    end\n    GameMode--&gt;&gt;-GameState: \n</code></pre> This flow demonstrates the decoupled communication. An external system sends a message, the <code>GameState</code> updates and broadcasts, and the <code>GameMode</code> reacts by coordinating the <code>PlayerController</code> and <code>Pawn</code> to reflect the new state.</p> <p>Sources: Source/StairwayFishingGameCore/Private/GameModeBase/GameModeBase_StairwayFishingGame.cpp:18-80, Source/StairwayFishingGameCore/Private/GameStateBase/GameStateBase_StairwayFishingGame.cpp:44-60, Source/StairwayFishingGameCore/Private/Pawn/Pawn_StairwayFishingGame.cpp:66-82</p>"},{"location":"fishing/#aplayercontroller_stairwayfishinggameplayercontroller","title":"<code>APlayerController_StairwayFishingGamePlayerController</code>","text":"<p>This class is responsible for translating player hardware input into gameplay actions using Unreal's Enhanced Input system. It implements the <code>IPlayerActionInputInterface</code> to expose delegates that other systems can bind to.</p>"},{"location":"fishing/#input-handling_2","title":"Input Handling","text":"<p>Key properties for input are defined in the header: | Property | Type | Description | | --- | --- | --- | | <code>DefaultInputMappingContext</code> | <code>UInputMappingContext*</code> | The mapping context that links keys to input actions. | | <code>CastingInputAction</code> | <code>UInputAction*</code> | The input action for the primary fishing cast. |</p> <p>Sources: Source/StairwayFishingGameCore/Public/PlayerController/PlayerController_StairwayFishingGamePlayerController.h:111-117</p> <p>In <code>BeginPlay</code>, the controller maps the <code>DefaultInputMappingContext</code>. The <code>MapInputActions</code> function then binds controller methods (<code>OnCastStarted</code>, <code>OnCastTriggered</code>, <code>OnCastFinished</code>) to the different trigger events of the <code>CastingInputAction</code>.</p> <pre><code>// Source/StairwayFishingGameCore/Private/PlayerController/PlayerController_StairwayFishingGamePlayerController.cpp:49-55\nvoid APlayerController_StairwayFishingGamePlayerController::MapInputActions()\n{\n    // ... error checking ...\n    EnhancedInputComponent-&gt;BindAction(CastingInputAction, ETriggerEvent::Started, this, &amp;ThisClass::OnCastStarted);\n    EnhancedInputComponent-&gt;BindAction(CastingInputAction, ETriggerEvent::Triggered, this, &amp;ThisClass::OnCastTriggered);\n    EnhancedInputComponent-&gt;BindAction(CastingInputAction, ETriggerEvent::Completed, this, &amp;ThisClass::OnCastFinished);\n}\n</code></pre> <p>These handler functions then broadcast their respective delegates, passing the elapsed time of the input action as a parameter. This allows listeners, such as the <code>UActorComponent_FishingComponent</code>, to react to the input without being tightly coupled to the <code>PlayerController</code>.</p> <p>Sources: Source/StairwayFishingGameCore/Private/PlayerController/PlayerController_StairwayFishingGamePlayerController.cpp:46-58, 70-72</p>"},{"location":"fishing/#apawn_stairwayfishinggame","title":"<code>APawn_StairwayFishingGame</code>","text":"<p>This class represents the player character in the game world. Since no player movement is required, it inherits from <code>APawn</code> instead of <code>ACharacter</code>. It contains all the necessary visual and logical components for the fishing gameplay.</p>"},{"location":"fishing/#components","title":"Components","text":"<p>The Pawn is an aggregate of several components that provide its functionality:</p> Component Type Description <code>Capsule</code> <code>UCapsuleComponent*</code> The root component, providing collision. <code>Mesh</code> <code>USkeletalMeshComponent*</code> The visual representation of the player character. <code>SpringArm</code> <code>USpringArmComponent*</code> Positions the main camera at a distance from the pawn. <code>Camera</code> <code>UCameraComponent*</code> The main top-down gameplay camera. Active by default. <code>CastMeterBarWidget</code> <code>UWidgetComponent*</code> A UI widget component for displaying the cast meter. <code>FishingComponent</code> <code>UActorComponent_FishingComponent*</code> The core component that contains all fishing logic. <code>ShowFishCamera</code> <code>UCameraComponent*</code> A secondary camera used for showing the caught fish. Inactive by default. <p>Sources: Source/StairwayFishingGameCore/Public/Pawn/Pawn_StairwayFishingGame.h:32-62</p>"},{"location":"fishing/#view-switching","title":"View Switching","text":"<p>The Pawn implements the <code>ISwitchableFishingViewInterface</code>, which requires it to define the <code>SetFishingView</code> method. This function is called by the <code>GameMode</code> during a state transition. It activates or deactivates the <code>Camera</code> and <code>ShowFishCamera</code> based on whether the new game state tag matches <code>FishingGameLoopState_Fishing</code>.</p> <p><pre><code>// Source/StairwayFishingGameCore/Private/Pawn/Pawn_StairwayFishingGame.cpp:73-82\nvoid APawn_StairwayFishingGame::SetFishingView(const FGameplayTag&amp; InFishingGameLoopStateTag)\n{\n    // ... validation ...\n    const bool bShouldFish = InFishingGameLoopStateTag.MatchesTag(FFishingTags::Get().FishingGameLoopState_Fishing);\n\n    if (Camera)\n    {\n        Camera-&gt;SetActive(bShouldFish);\n    }\n\n    if (ShowFishCamera)\n    {\n        ShowFishCamera-&gt;SetActive(!bShouldFish);\n    }\n}\n</code></pre> This simple mechanism allows the <code>GameMode</code> to control the player's perspective without needing to know the specific implementation details of the Pawn's cameras.</p> <p>Sources: Source/StairwayFishingGameCore/Public/Pawn/Pawn_StairwayFishingGame.h:25, Source/StairwayFishingGameCore/Private/Pawn/Pawn_StairwayFishingGame.cpp:66-82</p>"},{"location":"fishing/#summary","title":"Summary","text":"<p>The core gameplay classes of the Stairway Fishing Game create a robust and extensible foundation using standard Unreal Engine patterns. The <code>GameState</code> serves as a single source of truth for the game loop state, while the <code>GameMode</code> acts as a director, orchestrating transitions. Player interaction is cleanly handled by the <code>PlayerController</code> and its delegate system, which provides input to the <code>FishingComponent</code> on the <code>Pawn</code>. This separation of concerns ensures that each class has a distinct responsibility, making the system easier to maintain and expand.</p> <p></p>"},{"location":"fishing/#messaging-system-vagameplaymessaging","title":"Messaging System (VAGameplayMessaging)","text":""},{"location":"fishing/#related-pages_4","title":"Related Pages","text":"<p>Related topics: Module Overview, Fishing Gameplay Loop</p> Relevant source files The following files were used as context for generating this wiki page:  - [Source/VAGameplayMessaging/Public/GameInstanceSubsystem/VAGameplayMessagingSubsystem.h](https://github.com/rezonated/Unreal-Fishing-Test/blob/main/Source/VAGameplayMessaging/Public/GameInstanceSubsystem/VAGameplayMessagingSubsystem.h) - [Source/VAGameplayMessaging/Private/GameInstanceSubsystem/VAGameplayMessagingSubsystem.cpp](https://github.com/rezonated/Unreal-Fishing-Test/blob/main/Source/VAGameplayMessaging/Private/GameInstanceSubsystem/VAGameplayMessagingSubsystem.cpp) - [Source/VAGameplayMessaging/Public/VACancellableAsyncAction/VAGameplayMessaging_ListenForGameplayMessages.h](https://github.com/rezonated/Unreal-Fishing-Test/blob/main/Source/VAGameplayMessaging/Public/VACancellableAsyncAction/VAGameplayMessaging_ListenForGameplayMessages.h) - [Source/VAGameplayMessaging/Private/VACancellableAsyncAction/VAGameplayMessaging_ListenForGameplayMessages.cpp](https://github.com/rezonated/Unreal-Fishing-Test/blob/main/Source/VAGameplayMessaging/Private/VACancellableAsyncAction/VAGameplayMessaging_ListenForGameplayMessages.cpp) - [Source/FishingGameplayTags/Public/FishingTags.h](https://github.com/rezonated/Unreal-Fishing-Test/blob/main/Source/FishingGameplayTags/Public/FishingTags.h) - [Source/FishingFeature/Private/ActorComponent/ActorComponent_FishingComponent.cpp](https://github.com/rezonated/Unreal-Fishing-Test/blob/main/Source/FishingFeature/Private/ActorComponent/ActorComponent_FishingComponent.cpp) - [Source/StairwayFishingGameCore/Private/GameStateBase/GameStateBase_StairwayFishingGame.cpp](https://github.com/rezonated/Unreal-Fishing-Test/blob/main/Source/StairwayFishingGameCore/Private/GameStateBase/GameStateBase_StairwayFishingGame.cpp) - [Source/StairwayFishingGameUI/Private/UserWidget/MeterBar/UserWidgetMeterBar_CastMeterBar.cpp](https://github.com/rezonated/Unreal-Fishing-Test/blob/main/Source/StairwayFishingGameUI/Private/UserWidget/MeterBar/UserWidgetMeterBar_CastMeterBar.cpp)"},{"location":"fishing/#messaging-system-vagameplaymessaging_1","title":"Messaging System (VAGameplayMessaging)","text":"<p>The VAGameplayMessaging system provides a decoupled, event-driven communication framework for different parts of the application. It uses a centralized <code>UGameInstanceSubsystem</code> to manage message channels identified by <code>FGameplayTag</code>. This allows various game features, UI elements, and animation instances to communicate without holding direct references to each other, promoting modularity and reducing dependencies.</p> <p>Messages are broadcast on specific channels, and any object can listen to one or more channels using a cancellable asynchronous action. The system supports flexible data transfer through the <code>FVAAnyUnreal</code> struct, which can encapsulate any USTRUCT, UObject, or primitive type as a message payload.</p>"},{"location":"fishing/#core-architecture","title":"Core Architecture","text":"<p>The system is built around a central hub, <code>UVAGameplayMessagingSubsystem</code>, which is a <code>UGameInstanceSubsystem</code>. This ensures it has a global scope and persists for the entire game session. The subsystem's primary responsibility is to maintain a map of message channels and their corresponding listeners.</p> <ul> <li><code>UVAGameplayMessagingSubsystem</code>: The central singleton that manages all message channels and listeners.</li> <li><code>ChannelToMembersMap</code>: A <code>TMap&lt;FGameplayTag, FChannelMembersData&gt;</code> within the subsystem. It maps a gameplay tag (the channel) to a struct containing an array of active listeners.</li> <li><code>UVAGameplayMessaging_ListenForGameplayMessages</code>: A <code>UVACancellableAsyncAction</code> that acts as a proxy for any object wanting to listen to messages. It handles its own registration and unregistration with the subsystem.</li> </ul> <p>Sources: VAGameplayMessagingSubsystem.h:10-80, VAGameplayMessaging_ListenForGameplayMessages.h:14-43</p>"},{"location":"fishing/#component-relationships","title":"Component Relationships","text":"<p>The following diagram illustrates the relationship between the core components of the messaging system.</p> <p><pre><code>classDiagram\ndirection TD\nclass UVAGameplayMessagingSubsystem {\n    -TMap~FGameplayTag, FChannelMembersData~ ChannelToMembersMap\n    +Get(UObject*) UVAGameplayMessagingSubsystem&amp;\n    +BroadcastMessage(UObject*, FGameplayTag, FVAAnyUnreal) bool\n    +RegisterNewMember(FGameplayTagContainer, UVAGameplayMessaging_ListenForGameplayMessages*) bool\n    +UnregisterMember(UVAGameplayMessaging_ListenForGameplayMessages*) void\n}\nclass FChannelMembersData {\n    -TArray~UVAGameplayMessaging_ListenForGameplayMessages*~ ChannelMembers\n    +AddMembership(UVAGameplayMessaging_ListenForGameplayMessages*) void\n    +RemoveMembership(UVAGameplayMessaging_ListenForGameplayMessages*) void\n}\nclass UVAGameplayMessaging_ListenForGameplayMessages {\n    -FGameplayTagContainer ChannelsToRegister\n    +FAsyncGameplayMessageSignature OnGameplayMessageReceived\n    +ListenForGameplayMessagesViaChannel(UObject*, FGameplayTag) UVAGameplayMessaging_ListenForGameplayMessages*\n    +Activate() void\n    +SetReadyToDestroy() void\n}\n\nUVAGameplayMessagingSubsystem \"1\" o-- \"*\" FChannelMembersData : Manages\nFChannelMembersData \"1\" o-- \"*\" UVAGameplayMessaging_ListenForGameplayMessages : Contains\n</code></pre> This diagram shows that the <code>UVAGameplayMessagingSubsystem</code> contains a map of <code>FChannelMembersData</code>, and each <code>FChannelMembersData</code> instance holds a list of <code>UVAGameplayMessaging_ListenForGameplayMessages</code> listeners.</p> <p>Sources: VAGameplayMessagingSubsystem.h:10-80, VAGameplayMessaging_ListenForGameplayMessages.h:14-43</p>"},{"location":"fishing/#broadcasting-messages","title":"Broadcasting Messages","text":"<p>Messages are sent using the static function <code>UVAGameplayMessagingSubsystem::BroadcastMessage</code>. This function retrieves the subsystem instance and calls an internal method to perform the broadcast.</p> <p>The internal broadcast process is as follows: 1.  Validate the <code>InChannel</code> <code>FGameplayTag</code>. 2.  Check if the channel exists in the <code>ChannelToMembersMap</code>. 3.  Retrieve the list of listeners (<code>UVAGameplayMessaging_ListenForGameplayMessages*</code>) for that channel. 4.  Iterate through each listener, checking if it is valid. 5.  If a listener is invalid, it is removed from the channel's member list. 6.  For each valid listener, its <code>OnGameplayMessageReceived</code> delegate is broadcast, passing the channel tag and the message payload.</p> <p>Sources: VAGameplayMessagingSubsystem.cpp:53-125</p>"},{"location":"fishing/#broadcast-flow-diagram","title":"Broadcast Flow Diagram","text":"<p><pre><code>sequenceDiagram\n    participant Broadcaster as Game Logic&lt;br&gt;(e.g., FishingComponent)\n    participant Subsystem as UVAGameplayMessagingSubsystem\n    participant Listener as UVAGameplayMessaging_ListenForGameplayMessages\n    participant Receiver as Subscribed Object&lt;br&gt;(e.g., UI Widget)\n\n    Broadcaster-&gt;&gt;+Subsystem: BroadcastMessage(Channel, Payload)\n    Note over Subsystem: Get subsystem instance\n    Subsystem-&gt;&gt;Subsystem: BroadcastMessage_Internal(Channel, Payload)\n    Subsystem-&gt;&gt;Subsystem: Find listeners for Channel in ChannelToMembersMap\n    loop For each Listener\n        Subsystem-&gt;&gt;+Listener: Broadcast(OnGameplayMessageReceived)\n        Listener-&gt;&gt;+Receiver: Execute delegate binding\n        Receiver--&gt;&gt;-Listener: \n    end\n    Listener--&gt;&gt;-Subsystem: \n    Subsystem--&gt;&gt;-Broadcaster: return true/false\n</code></pre> This sequence shows a game object broadcasting a message, the subsystem finding and notifying the relevant listener, which in turn executes the delegate bound by the final receiving object.</p> <p>Sources: ActorComponent_FishingComponent.cpp:525, VAGameplayMessagingSubsystem.cpp:80-125, UserWidgetMeterBar_CastMeterBar.cpp:88-103</p>"},{"location":"fishing/#listening-for-messages","title":"Listening for Messages","text":"<p>Objects subscribe to message channels by creating an instance of <code>UVAGameplayMessaging_ListenForGameplayMessages</code>. This is typically done via one of its static factory functions, which are designed for use in both C++ and Blueprints.</p> <ol> <li>Creation: An object calls <code>ListenForGameplayMessagesViaChannel</code> or <code>ListenForGameplayMessagesViaMultipleChannels</code>. This creates a new proxy object (the listener).</li> <li>Activation: The listener's <code>Activate()</code> method is called.</li> <li>Registration: Inside <code>Activate()</code>, the listener calls <code>Subsystem-&gt;RegisterNewMember()</code>, passing a reference to itself and the channels it wants to subscribe to.</li> <li>Storage: The subsystem adds the listener to the <code>ChannelToMembersMap</code> for each requested channel. If a channel does not exist, it is created.</li> </ol> <p>The listener's <code>OnGameplayMessageReceived</code> delegate should be bound to a function in the subscribing object before activation to handle incoming messages.</p> <p>Sources: VAGameplayMessaging_ListenForGameplayMessages.cpp:7-54, VAGameplayMessagingSubsystem.cpp:127-172</p>"},{"location":"fishing/#listener-registration-and-cancellation-flow","title":"Listener Registration and Cancellation Flow","text":"<p><pre><code>sequenceDiagram\n    participant Subscriber as Game Logic&lt;br&gt;(e.g., GameState)\n    participant Listener as UVAGameplayMessaging_ListenForGameplayMessages\n    participant Subsystem as UVAGameplayMessagingSubsystem\n\n    Subscriber-&gt;&gt;Listener: ListenForGameplayMessagesViaChannel(this, Channel)\n    Note right of Subscriber: Binds to OnGameplayMessageReceived delegate\n    Subscriber-&gt;&gt;+Listener: Activate()\n    Listener-&gt;&gt;+Subsystem: RegisterNewMember(Channels, this)\n    Note over Subsystem: Adds listener to&lt;br&gt;ChannelToMembersMap\n    Subsystem--&gt;&gt;-Listener: return true\n    Listener--&gt;&gt;-Subscriber: \n\n    ...Time passes, messages are received...\n\n    Subscriber-&gt;&gt;+Listener: Cancel() / SetReadyToDestroy()\n    Listener-&gt;&gt;+Subsystem: UnregisterMember(this)\n    Note over Subsystem: Removes listener from&lt;br&gt;all channels\n    Subsystem--&gt;&gt;-Listener: \n    Listener--&gt;&gt;-Subscriber: \n</code></pre> This diagram illustrates the lifecycle of a listener, from its creation and registration with the subsystem to its eventual cancellation and unregistration.</p> <p>Sources: GameStateBase_StairwayFishingGame.cpp:21-28, VAGameplayMessaging_ListenForGameplayMessages.cpp:56-86, VAGameplayMessagingSubsystem.cpp:127-190</p>"},{"location":"fishing/#message-structure","title":"Message Structure","text":""},{"location":"fishing/#channels-fgameplaytag","title":"Channels (<code>FGameplayTag</code>)","text":"<p>Communication channels are defined by <code>FGameplayTag</code>. This leverages Unreal Engine's hierarchical tagging system, allowing for organized and easily identifiable message streams. A central class, <code>FFishingTags</code>, defines all the native gameplay tags used by the fishing feature, ensuring consistency.</p> <p>Example channels: *   <code>Messaging.Fishing.UI.Cast.Update</code>: Used to update the UI with the current casting progress. *   <code>Messaging.Fishing.Notify.Throw</code>: An animation notify that triggers the fishing rod to throw the bobber. *   <code>Messaging.GameState.StateChange</code>: Used to request a change in the global game state.</p> <p>Sources: FishingTags.h:35-55</p>"},{"location":"fishing/#payloads-fvaanyunreal","title":"Payloads (<code>FVAAnyUnreal</code>)","text":"<p>The system uses the <code>FVAAnyUnreal</code> struct for message payloads. This is a wrapper that can hold a value of almost any Unreal type, including primitives (<code>float</code>, <code>int32</code>), USTRUCTs, and UObjects. The receiving end can then safely check the type of the payload before attempting to extract the value.</p> <p><pre><code>// Example of a broadcaster sending a float payload\n// Source/FishingFeature/Private/ActorComponent/ActorComponent_FishingComponent.cpp:525-526\nUVAGameplayMessagingSubsystem::Get(this).BroadcastMessage(this, FFishingTags::Get().Messaging_Fishing_UI_Cast_Update, InProgress);\n\n// Example of a receiver handling the float payload\n// Source/StairwayFishingGameUI/Private/UserWidget/MeterBar/UserWidgetMeterBar_CastMeterBar.cpp:90-96\nconst bool bPayloadIsFloat = MessagePayload.Is&lt;float&gt;();\nif (!bPayloadIsFloat)\n{\n    // ... log error\n    return;\n}\nconst float Progress = MessagePayload.Get&lt;float&gt;();\n</code></pre> This provides type safety at runtime and avoids the need for multiple broadcast functions with different signatures.</p> <p>Sources: VAGameplayMessagingSubsystem.h:61, UserWidgetMeterBar_CastMeterBar.cpp:88-96, GameStateBase_StairwayFishingGame.cpp:52-58</p>"},{"location":"fishing/#lifecycle-management","title":"Lifecycle Management","text":"<p>The lifecycle of listeners is managed primarily by the <code>UVACancellableAsyncAction</code> base class. - Registration: When <code>Activate()</code> is called on a <code>UVAGameplayMessaging_ListenForGameplayMessages</code> instance, it registers itself with the subsystem. - Unregistration: When the async action is cancelled (e.g., via a <code>Cancel()</code> call or the owning object being destroyed), its <code>SetReadyToDestroy()</code> method is invoked. This method calls <code>Subsystem-&gt;UnregisterMember(this)</code>, which iterates through the entire <code>ChannelToMembersMap</code> and removes the listener from any channel it was a part of. - Cleanup: The <code>UVAGameplayMessagingSubsystem</code> itself, upon <code>Deinitialize()</code>, clears its <code>ChannelToMembersMap</code> entirely, ensuring no dangling references remain.</p> <p>Sources: VAGameplayMessaging_ListenForGameplayMessages.cpp:88-106, VAGameplayMessagingSubsystem.cpp:174-197</p>"},{"location":"fishing/#key-components-summary","title":"Key Components Summary","text":"Component Type Role Source File <code>UVAGameplayMessagingSubsystem</code> <code>UGameInstanceSubsystem</code> Central hub for message routing. Manages channels and listeners. <code>VAGameplayMessagingSubsystem.h</code> <code>UVAGameplayMessaging_ListenForGameplayMessages</code> <code>UVACancellableAsyncAction</code> Client-side proxy for subscribing to channels. Manages its own lifecycle. <code>VAGameplayMessaging_ListenForGameplayMessages.h</code> <code>FChannelMembersData</code> <code>USTRUCT</code> A container struct holding an array of listeners for a single channel. <code>VAGameplayMessagingSubsystem.h</code> <code>FGameplayTag</code> <code>struct</code> Used to define unique message channels. <code>FishingTags.h</code> <code>FVAAnyUnreal</code> <code>struct</code> A type-safe wrapper for message payloads of any type. <code>VAGameplayMessagingSubsystem.h</code>"},{"location":"fishing/#conclusion_1","title":"Conclusion","text":"<p>The VAGameplayMessaging system is a powerful, data-driven framework that enables robust, decoupled communication between different gameplay systems. By leveraging <code>UGameInstanceSubsystem</code> for global access, <code>FGameplayTag</code> for channel definition, and <code>UVACancellableAsyncAction</code> for lifecycle-aware listeners, it provides a clean and scalable solution for event handling within the project. Its use of <code>FVAAnyUnreal</code> for payloads adds a layer of type-safe flexibility, making it adaptable to a wide variety of communication needs. Error: Invalid operation: The <code>response.text</code> quick accessor requires the response to contain a valid <code>Part</code>, but none were returned. The candidate's finish_reason is 1.</p> <p></p>"},{"location":"fishing/#fishing-gameplay-loop","title":"Fishing Gameplay Loop","text":""},{"location":"fishing/#related-pages_5","title":"Related Pages","text":"<p>Related topics: Player Input and Controls, Configuration with Data Assets, Messaging System (VAGameplayMessaging)</p> Relevant source files  The following files were used as context for generating this wiki page:  - [Source/FishingFeature/Private/ActorComponent/ActorComponent_FishingComponent.cpp](https://github.comcom/rezonated/Unreal-Fishing-Test/blob/main/Source/FishingFeature/Private/ActorComponent/ActorComponent_FishingComponent.cpp) - [Source/FishingFeature/Private/Actor/Actor_FishingRod.cpp](https://github.comcom/rezonated/Unreal-Fishing-Test/blob/main/Source/FishingFeature/Private/Actor/Actor_FishingRod.cpp) - [Source/FishingFeature/Private/Actor/Actor_Fish.cpp](https://github.comcom/rezonated/Unreal-Fishing-Test/blob/main/Source/FishingFeature/Private/Actor/Actor_Fish.cpp) - [Source/FishingFeature/Private/Actor/Actor_FishSpawnArea.cpp](https://github.comcom/rezonated/Unreal-Fishing-Test/blob/main/Source/FishingFeature/Private/Actor/Actor_FishSpawnArea.cpp) - [Source/FishingGameplayTags/Private/FishingTags.cpp](https://github.comcom/rezonated/Unreal-Fishing-Test/blob/main/Source/FishingGameplayTags/Private/FishingTags.cpp) - [Source/StairwayFishingGameCore/Private/GameModeBase/GameModeBase_StairwayFishingGame.cpp](https://github.comcom/rezonated/Unreal-Fishing-Test/blob/main/Source/StairwayFishingGameCore/Private/GameModeBase/GameModeBase_StairwayFishingGame.cpp) - [Source/StairwayFishingGameCore/Private/Pawn/Pawn_StairwayFishingGame.cpp](https://github.comcom/rezonated/Unreal-Fishing-Test/blob/main/Source/StairwayFishingGameCore/Private/Pawn/Pawn_StairwayFishingGame.cpp)"},{"location":"fishing/#fishing-gameplay-loop_1","title":"Fishing Gameplay Loop","text":"<p>The Fishing Gameplay Loop is a self-contained feature that manages all logic related to casting a fishing rod, waiting for a fish to bite, and reeling it in. The system is orchestrated by the <code>UActorComponent_FishingComponent</code>, which acts as a state machine and mediator between the player, the fishing rod, and the fish.</p> <p>The feature is heavily reliant on a state management system using Gameplay Tags and communicates between different objects asynchronously via the <code>VAGameplayMessagingSubsystem</code>. This decoupled architecture allows for clear separation of concerns between player input, animation, game logic, and actor behaviors. The entire process is configurable through Data Assets, allowing designers to tweak parameters like casting distance, wait times, and actor classes without changing code.</p>"},{"location":"fishing/#core-components_1","title":"Core Components","text":"<p>The system is composed of several key actors and components that work together to create the fishing experience.</p> Component/Actor Role Source File <code>UActorComponent_FishingComponent</code> The central orchestrator of the fishing logic. Manages states, timers, player input, and communication between other components. <code>ActorComponent_FishingComponent.h</code> <code>AActor_FishingRod</code> Represents the physical fishing rod and bobber. Implements the <code>ICatcherInterface</code> and handles the visual throwing and reeling of the line. <code>Actor_FishingRod.cpp</code> <code>AActor_Fish</code> Represents a catchable fish. Implements the <code>ICatchableInterface</code> and manages its own movement, including wandering, being reeled in, and escaping. <code>Actor_Fish.cpp</code> <code>AActor_FishSpawnArea</code> Spawns a configurable number of <code>AActor_Fish</code> instances within a defined <code>UBoxComponent</code> volume at the start of the game. <code>Actor_FishSpawnArea.cpp</code> <code>AGameModeBase_StairwayFishingGame</code> Manages high-level game state transitions, such as fading the screen and switching cameras when a fish is caught and displayed. <code>GameModeBase_StairwayFishingGame.cpp</code> <code>APawn_StairwayFishingGame</code> The player's pawn which owns the <code>UActorComponent_FishingComponent</code> and holds the different cameras used for gameplay and showing the catch. <code>Pawn_StairwayFishingGame.cpp</code>"},{"location":"fishing/#component-relationships_1","title":"Component Relationships","text":"<p>The following diagram illustrates the primary relationships between the core classes. The <code>FishingComponent</code> acts as a central hub, interacting with the rod (<code>ICatcherInterface</code>) and the fish (<code>ICatchableInterface</code>).</p> <p><pre><code>classDiagram\n    direction TD\n    class UActorComponent {\n    }\n    class AActor {\n    }\n    class IMockableFishingInterface {\n        &lt;&lt;interface&gt;&gt;\n    }\n    class ICatcherInterface {\n        &lt;&lt;interface&gt;&gt;\n        Throw(FVector)\n        ReelBack()\n    }\n    class ICatchableInterface {\n        &lt;&lt;interface&gt;&gt;\n        ReeledIn(FVector)\n        Escape()\n        Catch(USceneComponent*)\n    }\n\n    UActorComponent &lt;|-- UActorComponent_FishingComponent\n    AActor &lt;|-- AActor_FishingRod\n    AActor &lt;|-- AActor_Fish\n\n    UActorComponent_FishingComponent ..|&gt; IMockableFishingInterface\n    AActor_FishingRod ..|&gt; ICatcherInterface\n    AActor_Fish ..|&gt; ICatchableInterface\n\n    UActorComponent_FishingComponent \"1\" -- \"1\" ICatcherInterface : CurrentCatcher\n    UActorComponent_FishingComponent \"1\" -- \"1\" ICatchableInterface : CurrentCatchable\n</code></pre> Sources: ActorComponent_FishingComponent.h, Actor_FishingRod.h, Actor_Fish.h</p>"},{"location":"fishing/#state-management-with-gameplay-tags","title":"State Management with Gameplay Tags","text":"<p>The fishing loop is driven by a state machine implemented within <code>UActorComponent_FishingComponent</code>. The current state is tracked using a <code>FGameplayTag</code>, which dictates how the component responds to player input and game events. All tags are centrally defined in the <code>FFishingTags</code> class.</p> <p>Sources: FishingTags.cpp:32-38, ActorComponent_FishingComponent.cpp:25</p>"},{"location":"fishing/#fishing-component-states","title":"Fishing Component States","text":"<p>The <code>FishingComponent.State.*</code> tags define the current stage of the fishing process.</p> Tag Description <code>FishingComponent.State.Idling</code> The default state. The player can start casting. <code>FishingComponent.State.Throwing</code> The player has finished charging the cast and the rod is being thrown. Input is ignored. <code>FishingComponent.State.WaitingForFish</code> The bobber is in the water. A timer is active, waiting for a fish to bite. Early input will cause the fish to escape. <code>FishingComponent.State.AbleToReel</code> The fish has bitten. The player must press the action button to reel it in. <code>FishingComponent.State.Reeling_In</code> The fish has been caught and is being reeled back to the player. <code>FishingComponent.State.Reeling_Out</code> The rod is being reeled back after a failed attempt or the fish escaped."},{"location":"fishing/#animation-states","title":"Animation States","text":"<p>A parallel set of tags, <code>AnimInstance.Fishing.State.*</code>, is used to drive the character's animations. These are broadcast via the messaging system to the character's Animation Blueprint.</p> Tag Description <code>AnimInstance.Fishing.State.Idling</code> Corresponds to the idle animation state. <code>AnimInstance.Fishing.State.Throwing</code> Triggers the casting/throwing animation montage. <code>AnimInstance.Fishing.State.Reeling_In</code> Triggers the animation for successfully reeling in a fish. <code>AnimInstance.Fishing.State.Reeling_Out</code> Triggers the animation for reeling in an empty line. <code>AnimInstance.Fishing.State.ShowFish</code> Triggers the animation for showing off the caught fish. <p>Sources: FishingTags.cpp:22-28</p>"},{"location":"fishing/#state-machine-flow","title":"State Machine Flow","text":"<p>The diagram below shows the typical flow of states within the <code>UActorComponent_FishingComponent</code>.</p> <p><pre><code>graph TD\n    subgraph Fishing State Machine\n        A[Idling] --&gt;|Hold Cast Action| B(Casting Preview)\n        B --&gt;|Release Cast Action| C(Throwing)\n        C --&gt;|Bobber Lands| D(WaitingForFish)\n        D --&gt;|Timer Finishes| E(AbleToReel)\n        D --&gt;|Early Input| F(Reeling_Out)\n        E --&gt;|Cast Action| G(Reeling_In)\n        F --&gt;|Reel Finished| A\n        G --&gt;|Reel Finished| H(Show Fish State)\n    end\n</code></pre> Sources: ActorComponent_FishingComponent.cpp</p>"},{"location":"fishing/#the-fishing-process-step-by-step","title":"The Fishing Process Step-by-Step","text":"<p>The entire fishing sequence, from casting to catching, follows a well-defined series of events orchestrated by the <code>FishingComponent</code>.</p>"},{"location":"fishing/#1-initialization-and-spawning","title":"1. Initialization and Spawning","text":"<ul> <li>Fish Spawning: On <code>BeginPlay</code>, the <code>AActor_FishSpawnArea</code> asynchronously loads the <code>FishActorClass</code> defined in its config. Once loaded, it spawns a specified number of fish actors at random locations within its <code>UBoxComponent</code> bounds. Each fish is initialized with the spawn area's center and extent, which it uses for its wandering behavior.     Sources: Actor_FishSpawnArea.cpp:38-40, Actor_FishSpawnArea.cpp:84-118, Actor_Fish.cpp:151-153</li> <li>Rod Spawning: The <code>UActorComponent_FishingComponent</code> also asynchronously loads its <code>FishingRodActorClass</code>. When loaded, the fishing rod actor is spawned and attached to a specified socket on the owner's skeletal mesh.     Sources: ActorComponent_FishingComponent.cpp:40-47, ActorComponent_FishingComponent.cpp:241-274</li> </ul>"},{"location":"fishing/#2-casting-the-line","title":"2. Casting the Line","text":"<ul> <li>Charging the Cast: The player presses and holds the cast action button. This calls <code>OnCastAction</code> in the <code>FishingComponent</code>.</li> <li>Determining Location: While the button is held, <code>DetermineCastLocation</code> is called continuously. It maps the elapsed time the button has been held to a distance between a minimum and maximum value. This determines the cast's target position in front of the player.     <pre><code>// Source/FishingFeature/Private/ActorComponent/ActorComponent_FishingComponent.cpp:602-604\nconst float MappedForwardDistance = FMath::GetMappedRangeValueClamped(FVector2D(0.f, MaximumTimeToCast), FVector2D(MinimumCastDistance, MaximumCastDistance), InElapsedTime);\nconst FVector ForwardDirection = InitialActorForwardVector * MappedForwardDistance;\nconst FVector CastStartPosition = InitialActorLocation + ForwardDirection;\n</code></pre> Sources: ActorComponent_FishingComponent.cpp:592-608</li> <li>Finding the Water: <code>AttemptToCast</code> then performs a line trace downwards from the target position to find a water body (identified by the <code>TRACE_WATER_BODY</code> collision channel). If water is found, the hit location is stored as <code>CastLocation</code>, and a decal actor is made visible at that spot to give the player feedback.     Sources: ActorComponent_FishingComponent.cpp:611-641</li> </ul>"},{"location":"fishing/#3-throwing-and-waiting","title":"3. Throwing and Waiting","text":"<ul> <li>Throwing: When the player releases the cast button, <code>OnCastActionEnded</code> is called. The component's state changes to <code>Throwing</code>, and it broadcasts a message to the animation system to play the \"throwing\" animation.     Sources: ActorComponent_FishingComponent.cpp:559-561</li> <li>Animation Notify: The throwing animation contains a notify that sends a <code>Messaging.Fishing.Notify.Throw</code> message. The <code>FishingComponent</code> listens for this message and, upon receiving it, calls the <code>Throw()</code> method on the <code>CurrentCatcher</code> (the fishing rod).     Sources: ActorComponent_FishingComponent.cpp:732-741</li> <li>Bobber Movement: <code>AActor_FishingRod::Throw</code> starts a timeline (<code>ThrowReelInTimeline</code>) that interpolates the bobber's position from the rod to the <code>CastLocation</code>.     Sources: Actor_FishingRod.cpp:29-32</li> <li>Landing on Water: When the timeline finishes, a delegate is executed, calling <code>OnBobberLandsOnWater</code> in the <code>FishingComponent</code>.     Sources: Actor_FishingRod.cpp:180-182, ActorComponent_FishingComponent.cpp:564-572</li> <li>Finding a Fish: The component then performs a sphere trace around the <code>CastLocation</code> to find the nearest <code>ICatchableInterface</code> (a fish).     Sources: ActorComponent_FishingComponent.cpp:484-526</li> <li>Waiting Period: A timer is started for a duration defined by <code>TimeToFish</code> in the config, and the state changes to <code>WaitingForFish</code>. The targeted fish is notified via its <code>ReeledIn()</code> method, causing it to swim towards the bobber.     Sources: ActorComponent_FishingComponent.cpp:529-540, Actor_Fish.cpp:53-60</li> </ul>"},{"location":"fishing/#4-reeling-in-the-catch","title":"4. Reeling In the Catch","text":"<ul> <li>The Bite: When the <code>WaitingForFish</code> timer completes, the state transitions to <code>AbleToReel</code>.     Sources: ActorComponent_FishingComponent.cpp:477-482</li> <li>Player Action: The player must now press the cast action button again. If they do, <code>OnCastAction</code> is triggered while in the <code>AbleToReel</code> state.</li> <li>Catching: The fish is \"caught\" by calling <code>CurrentCatchable-&gt;Catch()</code>, which attaches the fish actor to an attach point on the fishing rod's bobber. The <code>ReelBack()</code> method is then called on the rod.     Sources: ActorComponent_FishingComponent.cpp:443-458</li> <li>Reeling Back: <code>AActor_FishingRod::ReelBack</code> uses another timeline (<code>PullReelOutTimeline</code>) to move the bobber (and the attached fish) back to its starting position on the rod.     Sources: Actor_FishingRod.cpp:34-37</li> </ul>"},{"location":"fishing/#5-success-and-failure","title":"5. Success and Failure","text":"<ul> <li>Success: If the reeling process completes with a fish attached, an animation notify sends a <code>Messaging.Fishing.Notify.ReelDone</code> message. The <code>FishingComponent</code> receives this and broadcasts another message, <code>Messaging_GameState_StateChange</code>, with the payload <code>FishingGameLoopState_ShowFish</code>.     Sources: ActorComponent_FishingComponent.cpp:743-757</li> <li>Failure (Escaping Fish): If the player presses the action button during the <code>WaitingForFish</code> state (before the timer finishes), it is considered an early reel. <code>LetCatchableEscape</code> is called, which in turn calls the <code>Escape()</code> method on the fish. The fish plays an escape timeline to swim back to its original location, and the player reels in an empty line.     Sources: ActorComponent_FishingComponent.cpp:542-552, ActorComponent_FishingComponent.cpp:542-552, Actor_Fish.cpp:62-67</li> </ul>"},{"location":"fishing/#system-communication-and-game-state-flow","title":"System Communication and Game State Flow","text":"<p>The <code>VAGameplayMessagingSubsystem</code> is used for decoupled communication between different parts of the game. This is particularly important for triggering logic from animation notifies and for signaling changes to the main game mode.</p> <p>The sequence diagram below details the interactions during a successful fishing attempt.</p> <p><pre><code>sequenceDiagram\n    autonumber\n    participant Player\n    participant PlayerInput\n    participant FishingComponent\n    participant AnimInstance\n    participant FishingRod\n    participant Fish\n    participant GameMode\n\n    Player-&gt;&gt;+PlayerInput: Hold Cast Button\n    PlayerInput-&gt;&gt;+FishingComponent: OnCastAction(elapsedTime)\n    Note over FishingComponent: State: Idling\n    FishingComponent--&gt;&gt;-PlayerInput:\n    Player-&gt;&gt;+PlayerInput: Release Cast Button\n    PlayerInput-&gt;&gt;+FishingComponent: OnCastActionEnded()\n    FishingComponent-&gt;&gt;AnimInstance: BroadcastMessage(AnimInstance_Fishing_State_Throwing)\n    Note over FishingComponent: State -&gt; Throwing\n    FishingComponent--&gt;&gt;-PlayerInput:\n\n    AnimInstance-&gt;&gt;+FishingComponent: OnThrowNotifyMessageReceived()\n    FishingComponent-&gt;&gt;+FishingRod: Throw(castLocation)\n    FishingRod--&gt;&gt;-FishingComponent:\n\n    loop Bobber Movement Timeline\n        FishingRod-&gt;&gt;FishingRod: Interpolate bobber location\n    end\n\n    FishingRod-&gt;&gt;+FishingComponent: OnBobberLandsOnWater()\n    Note over FishingComponent: State -&gt; WaitingForFish\n    FishingComponent-&gt;&gt;+Fish: ReeledIn(bobberLocation)\n    Fish--&gt;&gt;-FishingComponent:\n    Note over FishingComponent: Starts Wait Timer\n\n    alt Player reels in too early\n        Player-&gt;&gt;PlayerInput: Press Cast Button\n        PlayerInput-&gt;&gt;FishingComponent: OnCastActionEnded()\n        FishingComponent-&gt;&gt;Fish: Escape()\n    else Timer Finishes\n        Note over FishingComponent: State -&gt; AbleToReel\n        Player-&gt;&gt;+PlayerInput: Press Cast Button\n        PlayerInput-&gt;&gt;+FishingComponent: OnCastAction(0)\n        FishingComponent-&gt;&gt;+Fish: Catch(attachPoint)\n        Fish--&gt;&gt;-FishingComponent:\n        FishingComponent-&gt;&gt;+FishingRod: ReelBack()\n        FishingRod--&gt;&gt;-FishingComponent:\n        Note over FishingComponent: State -&gt; Reeling_In\n        FishingComponent--&gt;&gt;-PlayerInput:\n    end\n\n    AnimInstance-&gt;&gt;+FishingComponent: OnReelDoneNotifyMessageReceived()\n    FishingComponent-&gt;&gt;+GameMode: BroadcastMessage(FishingGameLoopState_ShowFish)\n    GameMode-&gt;&gt;+GameMode: OnFishingGameLoopStateChanged()\n    GameMode-&gt;&gt;GameMode: TriggerScreenFadeInOut()\n    GameMode--&gt;&gt;-GameMode:\n    GameMode--&gt;&gt;-FishingComponent:\n</code></pre> Sources: ActorComponent_FishingComponent.cpp, GameModeBase_StairwayFishingGame.cpp, FishingTags.cpp</p> <p>When the <code>GameMode</code> receives the <code>FishingGameLoopState_ShowFish</code> message, it initiates a screen fade, switches the active camera on the player pawn to a \"show fish\" camera, and changes the input mode to UI-only, presenting the player with options to continue or quit.</p> <p>Sources: GameModeBase_StairwayFishingGame.cpp:32-84, Pawn_StairwayFishingGame.cpp:58-75</p>"},{"location":"fishing/#testability","title":"Testability","text":"<p>The system is designed with testability in mind. The <code>UActorComponent_FishingComponent</code> implements the <code>IMockableFishingInterface</code>, which exposes methods to drive the fishing logic programmatically.</p> <ul> <li><code>MockCast(float InElapsedTime)</code>: Simulates holding the cast button for a specific duration.</li> <li><code>MockCastEnd()</code>: Simulates releasing the cast button.</li> </ul> <p>Functional tests, such as <code>AFunctionalTest_FishingFeatureTest</code>, can get a reference to this interface and call these methods to validate the entire fishing loop without requiring actual player input. The interface also provides delegates like <code>OnMockAbleToCatchFishDone</code> and <code>OnMockBobberLandsOnWater</code> that tests can bind to for asserting outcomes at specific stages of the process.</p> <p>Sources: ActorComponent_FishingComponent.h:81-98, FunctionalTest_FishingFeatureTest.cpp:21-72</p> <p></p>"},{"location":"fishing/#player-input-and-controls","title":"Player Input and Controls","text":""},{"location":"fishing/#related-pages_6","title":"Related Pages","text":"<p>Related topics: Fishing Gameplay Loop</p> Relevant source files The following files were used as context for generating this wiki page:  - [Source/StairwayFishingGameCore/Public/PlayerController/PlayerController_StairwayFishingGamePlayerController.h](https://github.com/rezonated/Unreal-Fishing-Test/blob/main/Source/StairwayFishingGameCore/Public/PlayerController/PlayerController_StairwayFishingGamePlayerController.h) - [Source/StairwayFishingGameCore/Private/PlayerController/PlayerController_StairwayFishingGamePlayerController.cpp](https://github.com/rezonated/Unreal-Fishing-Test/blob/main/Source/StairwayFishingGameCore/Private/PlayerController/PlayerController_StairwayFishingGamePlayerController.cpp) - [Source/FishingFeature/Private/ActorComponent/ActorComponent_FishingComponent.cpp](https://github.com/rezonated/Unreal-Fishing-Test/blob/main/Source/FishingFeature/Private/ActorComponent/ActorComponent_FishingComponent.cpp) - [Source/StairwayFishingGameCore/Public/GameModeBase/GameModeBase_StairwayFishingGame.h](https://github.com/rezonated/Unreal-Fishing-Test/blob/main/Source/StairwayFishingGameCore/Public/GameModeBase/GameModeBase_StairwayFishingGame.h) - [Source/StairwayFishingGameCore/Private/GameModeBase/GameModeBase_StairwayFishingGame.cpp](https://github.com/rezonated/Unreal-Fishing-Test/blob/main/Source/StairwayFishingGameCore/Private/GameModeBase/GameModeBase_StairwayFishingGame.cpp) - [Source/StairwayFishingGameCore/Public/Pawn/Pawn_StairwayFishingGame.h](https://github.com/rezonated/Unreal-Fishing-Test/blob/main/Source/StairwayFishingGameCore/Public/Pawn/Pawn_StairwayFishingGame.h)"},{"location":"fishing/#player-input-and-controls_1","title":"Player Input and Controls","text":"<p>The player input and control system is built upon Unreal Engine's Enhanced Input System. It provides a decoupled, event-driven architecture for handling player actions, primarily the fishing cast mechanic. The core components include a dedicated Player Controller that interprets raw input, an interface to broadcast input events, and a consumer component that implements the game logic. The system is also managed by the Game Mode, which controls whether the player is in a \"Game\" or \"UI\" input context based on the current game state.</p> <p>The primary input action is the \"Casting\" action, which is bound to multiple trigger events (Started, Triggered, Completed) to allow for nuanced control, such as charging a cast by holding down a button. This design separates the input handling from the game mechanics, allowing different components to react to player input without being tightly coupled to the <code>PlayerController</code>.</p>"},{"location":"fishing/#architecture-overview","title":"Architecture Overview","text":"<p>The system revolves around four key classes that collaborate to translate a physical input into a gameplay action. The <code>APlayerController_StairwayFishingGamePlayerController</code> is the central hub, responsible for setting up input mappings and broadcasting actions. It uses the <code>IPlayerActionInputInterface</code> to expose delegates, which are then bound by the <code>UActorComponent_FishingComponent</code> to execute fishing logic. The <code>AGameModeBase_StairwayFishingGame</code> oversees the process by managing the overall input mode.</p> <p>Sources: PlayerController_StairwayFishingGamePlayerController.h, ActorComponent_FishingComponent.cpp, GameModeBase_StairwayFishingGame.h</p> <pre><code>classDiagram\ndirection TD\n\nclass APlayerController_StairwayFishingGamePlayerController {\n  +UInputMappingContext* DefaultInputMappingContext\n  +UInputAction* CastingInputAction\n  +FOnPlayerActionInput OnCastStartedDelegate\n  +FOnPlayerActionInput OnCastTriggeredDelegate\n  +FOnPlayerActionInput OnCastCompletedDelegate\n  +BeginPlay()\n  +MapInputContext()\n  +MapInputActions()\n  +OnCastStarted()\n  +OnCastTriggered()\n  +OnCastFinished()\n}\n\nclass IPlayerActionInputInterface {\n  &lt;&lt;Interface&gt;&gt;\n  +OnCastActionStarted() FOnPlayerActionInput&amp;\n  +OnCastActionTriggered() FOnPlayerActionInput&amp;\n  +OnCastActionCompleted() FOnPlayerActionInput&amp;\n}\n\nclass UActorComponent_FishingComponent {\n  -IPlayerActionInputInterface* OwnerControllerAsPlayerActionInput\n  +BeginPlay()\n  +BindToPlayerActionInputDelegates()\n  +OnCastAction(float InElapsedTime)\n  +OnCastActionEnded(float)\n}\n\nclass AGameModeBase_StairwayFishingGame {\n  +OnFishingGameLoopStateChanged()\n  +TogglePlayerControllerMode(bool bIsEnabled)\n}\n\nAPlayerController_StairwayFishingGamePlayerController --|&gt; APlayerController\nAPlayerController_StairwayFishingGamePlayerController ..|&gt; IPlayerActionInputInterface: implements\nUActorComponent_FishingComponent --* APawn_StairwayFishingGame : component of\nUActorComponent_FishingComponent ..&gt; IPlayerActionInputInterface : uses/binds to\nAGameModeBase_StairwayFishingGame --|&gt; AGameModeBase\nAGameModeBase_StairwayFishingGame ..&gt; APlayerController_StairwayFishingGamePlayerController : manages input mode\n</code></pre>"},{"location":"fishing/#input-handling-flow","title":"Input Handling Flow","text":"<p>The following diagram illustrates the sequence of events from a player's physical input to the execution of the corresponding game logic within the <code>UActorComponent_FishingComponent</code>.</p> <pre><code>sequenceDiagram\n    participant Player as actor Player\n    participant EILS as UEnhancedInput&lt;br&gt;LocalPlayerSubsystem\n    participant PC as APlayerController_StairwayFishingGamePlayerController\n    participant FC as UActorComponent_FishingComponent\n\n    Player-&gt;&gt;+EILS: Press/Hold/Release Cast Input\n    EILS-&gt;&gt;+PC: OnCastStarted(instance)\n    PC-&gt;&gt;PC: BroadcastCastDelegateAndValue(OnCastStartedDelegate, instance)\n    PC-&gt;&gt;+FC: OnCastAction(elapsedTime)\n    FC--&gt;&gt;-PC:\n    PC--&gt;&gt;-EILS:\n\n    loop While input held\n        EILS-&gt;&gt;+PC: OnCastTriggered(instance)\n        PC-&gt;&gt;PC: BroadcastCastDelegateAndValue(OnCastTriggeredDelegate, instance)\n        PC-&gt;&gt;+FC: OnCastAction(elapsedTime)\n        FC--&gt;&gt;-PC:\n        PC--&gt;&gt;-EILS:\n    end\n\n    EILS-&gt;&gt;+PC: OnCastCompleted(instance)\n    PC-&gt;&gt;PC: BroadcastCastDelegateAndValue(OnCastCompletedDelegate, instance)\n    PC-&gt;&gt;+FC: OnCastActionEnded(elapsedTime)\n    FC--&gt;&gt;-PC:\n    PC--&gt;&gt;-EILS:\n    EILS--&gt;&gt;-Player:\n</code></pre>"},{"location":"fishing/#key-components_1","title":"Key Components","text":""},{"location":"fishing/#aplayercontroller_stairwayfishinggameplayercontroller_1","title":"APlayerController_StairwayFishingGamePlayerController","text":"<p>This class is the primary handler for player input. It is configured with an Input Mapping Context and specific Input Actions to translate hardware inputs into game events.</p> <p>Sources: PlayerController_StairwayFishingGamePlayerController.h, PlayerController_StairwayFishingGamePlayerController.cpp</p>"},{"location":"fishing/#initialization-and-mapping","title":"Initialization and Mapping","text":"<p>On <code>BeginPlay</code>, the controller adds its <code>DefaultInputMappingContext</code> to the <code>UEnhancedInputLocalPlayerSubsystem</code> and binds its handler functions to the <code>CastingInputAction</code>.</p> <p><pre><code>// Source/StairwayFishingGameCore/Private/PlayerController/PlayerController_StairwayFishingGamePlayerController.cpp:48-60\nvoid APlayerController_StairwayFishingGamePlayerController::MapInputActions()\n{\n    UEnhancedInputComponent* EnhancedInputComponent = nullptr;\n    if (!GetEnhancedInputComponent(EnhancedInputComponent))\n    {\n        // ... error logging ...\n        return;\n    }\n    if (!CastingInputAction)\n    {\n        // ... error logging ...\n        return;\n    }\n\n    EnhancedInputComponent-&gt;BindAction(CastingInputAction, ETriggerEvent::Started, this, &amp;ThisClass::OnCastStarted);\n    EnhancedInputComponent-&gt;BindAction(CastingInputAction, ETriggerEvent::Triggered, this, &amp;ThisClass::OnCastTriggered);\n    EnhancedInputComponent-&gt;BindAction(CastingInputAction, ETriggerEvent::Completed, this, &amp;ThisClass::OnCastFinished);\n}\n</code></pre> Sources: PlayerController_StairwayFishingGamePlayerController.cpp:48-74</p>"},{"location":"fishing/#iplayeractioninputinterface","title":"IPlayerActionInputInterface","text":"<p>To decouple input broadcasting from any specific consumer, the controller implements the <code>IPlayerActionInputInterface</code>. This interface defines a contract for any class that wants to provide player action events. It exposes delegates for the three primary states of the cast action.</p> Delegate Description <code>OnCastActionStarted()</code> Fired once when the <code>CastingInputAction</code> is started (e.g., button press). <code>OnCastActionTriggered()</code> Fired every frame that the <code>CastingInputAction</code> is active (e.g., button held). <code>OnCastActionCompleted()</code> Fired once when the <code>CastingInputAction</code> is completed (e.g., button release). <p>Sources: PlayerController_StairwayFishingGamePlayerController.h:23-41</p>"},{"location":"fishing/#uactorcomponent_fishingcomponent_1","title":"UActorComponent_FishingComponent","text":"<p>This component contains the core fishing logic and acts as the consumer of the input events broadcast by the <code>PlayerController</code>.</p>"},{"location":"fishing/#delegate-binding","title":"Delegate Binding","text":"<p>In its <code>BeginPlay</code> sequence, the <code>UActorComponent_FishingComponent</code> finds the pawn's controller, verifies it implements <code>IPlayerActionInputInterface</code>, and binds its own functions to the interface's delegates. This establishes the communication link without the component needing a direct reference to the concrete <code>PlayerController</code> class.</p> <p><pre><code>// Source/FishingFeature/Private/ActorComponent/ActorComponent_FishingComponent.cpp:659-664\nvoid UActorComponent_FishingComponent::BindToPlayerActionInputDelegates()\n{\n    // ... code to get OwnerControllerAsPlayerActionInput ...\n\n    OwnerControllerAsPlayerActionInput-&gt;OnCastActionStarted().BindUObject(this, &amp;ThisClass::OnCastAction);\n    OwnerControllerAsPlayerActionInput-&gt;OnCastActionTriggered().BindUObject(this, &amp;ThisClass::OnCastAction);\n    OwnerControllerAsPlayerActionInput-&gt;OnCastActionCompleted().BindUObject(this, &amp;ThisClass::OnCastActionEnded);\n}\n</code></pre> Sources: ActorComponent_FishingComponent.cpp:635-664</p> <p>The <code>OnCastAction</code> method handles both starting the cast and reeling in a fish, depending on the current <code>CurrentFishingState</code>. The <code>OnCastActionEnded</code> method is responsible for executing the throw after the player releases the input.</p> <p>Sources: ActorComponent_FishingComponent.cpp:666-688, 862-894</p>"},{"location":"fishing/#input-mode-management","title":"Input Mode Management","text":"<p>The <code>AGameModeBase_StairwayFishingGame</code> is responsible for managing the global input mode of the <code>PlayerController</code>. This ensures the player can only control the character when appropriate and can interact with UI elements at other times.</p> <p>Sources: GameModeBase_StairwayFishingGame.h, GameModeBase_StairwayFishingGame.cpp</p>"},{"location":"fishing/#state-driven-control","title":"State-Driven Control","text":"<p>The <code>OnFishingGameLoopStateChanged</code> function is the entry point for this logic. When the game state changes (e.g., from <code>Fishing</code> to <code>ShowFish</code>), it calls <code>TogglePlayerControllerMode</code> to update the input settings.</p> <p><pre><code>graph TD\n    A[Game State Changes] --&gt; B{OnFishingGameLoopStateChanged};\n    B --&gt; C{bShouldFish = State == Fishing?};\n    C --&gt;|true| D[TogglePlayerControllerMode(true)];\n    C --&gt;|false| E[TogglePlayerControllerMode(false)];\n    D --&gt; F[SetInputMode(GameOnly)&lt;br&gt;HideMouseCursor()];\n    E --&gt; G[SetInputMode(UIOnly)&lt;br&gt;ShowMouseCursor()];\n</code></pre> Sources: GameModeBase_StairwayFishingGame.cpp:21-81</p> <p>The <code>TogglePlayerControllerMode</code> function directly manipulates the <code>PlayerController</code> to switch between game input and UI input.</p> State Input Mode Mouse Cursor Fishing <code>FInputModeGameOnly</code> Hidden Not Fishing <code>FInputModeUIOnly</code> Visible <p><pre><code>// Source/StairwayFishingGameCore/Private/GameModeBase/GameModeBase_StairwayFishingGame.cpp:131-147\nvoid AGameModeBase_StairwayFishingGame::TogglePlayerControllerMode(APlayerController* InPlayerController, const bool&amp; bIsEnabled) const\n{\n    if (!InPlayerController)\n    {\n        // ... error logging ...\n        return;\n    }\n\n    InPlayerController-&gt;EnableInput(InPlayerController);\n\n    if (!bIsEnabled)\n    {\n        InPlayerController-&gt;SetInputMode(FInputModeUIOnly());\n    }\n    else\n    {\n        InPlayerController-&gt;SetInputMode(FInputModeGameOnly());\n    }\n\n    InPlayerController-&gt;SetShowMouseCursor(!bIsEnabled);\n}\n</code></pre> Sources: GameModeBase_StairwayFishingGame.cpp:131-147</p> <p></p>"},{"location":"fishing/#configuration-with-data-assets","title":"Configuration with Data Assets","text":""},{"location":"fishing/#related-pages_7","title":"Related Pages","text":"<p>Related topics: Fishing Gameplay Loop</p> Relevant source files The following files were used as context for generating this wiki page:  - [Source/FishingFeature/Public/DataAsset/DataAsset_FishingComponentConfig.h](https://github.com/rezonated/Unreal-Fishing-Test/blob/main/Source/FishingFeature/Public/DataAsset/DataAsset_FishingComponentConfig.h) - [Source/FishingFeature/Private/ActorComponent/ActorComponent_FishingComponent.cpp](https://github.com/rezonated/Unreal-Fishing-Test/blob/main/Source/FishingFeature/Private/ActorComponent/ActorComponent_FishingComponent.cpp) - [Source/FishingFeature/Public/DataAsset/DataAsset_FishSpawnAreaConfig.h](https://github.com/rezonated/Unreal-Fishing-Test/blob/main/Source/FishingFeature/Public/DataAsset/DataAsset_FishSpawnAreaConfig.h) - [Source/FishingFeature/Private/Actor/Actor_FishSpawnArea.cpp](https://github.com/rezonated/Unreal-Fishing-Test/blob/main/Source/FishingFeature/Private/Actor/Actor_FishSpawnArea.cpp) - [Source/FishingFeature/Public/DataAsset/DataAsset_ActorFishConfig.h](https://github.com/rezonated/Unreal-Fishing-Test/blob/main/Source/FishingFeature/Public/DataAsset/DataAsset_ActorFishConfig.h) - [Source/FishingFeature/Private/Actor/Actor_Fish.cpp](https://github.com/rezonated/Unreal-Fishing-Test/blob/main/Source/FishingFeature/Private/Actor/Actor_Fish.cpp) - [Source/FishingFeature/Public/Actor/Actor_FishingRod.h](https://github.com/rezonated/Unreal-Fishing-Test/blob/main/Source/FishingFeature/Public/Actor/Actor_FishingRod.h) - [Source/FishingFeature/Private/Actor/Actor_FishingRod.cpp](https://github.com/rezonated/Unreal-Fishing-Test/blob/main/Source/FishingFeature/Private/Actor/Actor_FishingRod.cpp)"},{"location":"fishing/#configuration-with-data-assets_1","title":"Configuration with Data Assets","text":"<p>The fishing system is designed to be highly configurable through Unreal Engine's Data Asset pattern. This approach decouples gameplay parameters from the core C++ logic, allowing designers to create and modify different fishing behaviors, fish types, and spawning rules by editing asset files in the editor without changing code. The primary mechanism involves creating <code>UDataAsset</code>-derived classes that hold specific configuration structures. Actors and Components within the system then hold an editable reference to these Data Assets to retrieve their settings during initialization.</p> <p>This document outlines the architecture of this configuration system and details the various Data Assets used to control the fishing feature, including the main <code>FishingComponent</code>, the <code>FishingRod</code>, individual <code>Fish</code> actors, and <code>FishSpawnArea</code>s.</p>"},{"location":"fishing/#core-configuration-architecture","title":"Core Configuration Architecture","text":"<p>The system's configuration is based on a consistent pattern where a C++ struct defines a set of related properties, and a <code>UDataAsset</code> class acts as a container for an instance of that struct. This Data Asset can then be created and edited within the Unreal Editor. Game objects, such as Actors and Actor Components, expose a <code>UPROPERTY(EditAnywhere)</code> pointer to the specific Data Asset type they require, allowing designers to assign a configuration asset in the editor.</p> <p>The diagram below illustrates the relationship between a game object (<code>UActorComponent_FishingComponent</code>), its Data Asset (<code>UDataAsset_FishingComponentConfig</code>), and the underlying configuration struct (<code>FFishingComponentConfig</code>).</p> <p><pre><code>graph TD\n    subgraph \"C++ Code\"\n        A[FFishingComponentConfig Struct] --&gt; B(UDataAsset_FishingComponentConfig Class);\n        B -- \"Contains instance of\" --&gt; A;\n        C(UActorComponent_FishingComponent Class) -- \"Holds UPROPERTY pointer to\" --&gt; B;\n    end\n\n    subgraph \"Unreal Editor\"\n        D(DA_FishingComponentConfig Asset) -- \"Instance of\" --&gt; B;\n        E(Blueprint Actor) -- \"Has instance of\" --&gt; C;\n        E -- \"Assigns Asset\" --&gt; D;\n    end\n\n    C -- \"Reads config from\" --&gt; D;\n</code></pre> This diagram shows how the <code>UActorComponent_FishingComponent</code> class holds a reference to a <code>UDataAsset_FishingComponentConfig</code> class. In the editor, a Blueprint actor with this component assigns a specific Data Asset (e.g., <code>DA_FishingComponentConfig</code>) to it. The component then reads its configuration values from this asset at runtime.</p> <p>Sources: Source/FishingFeature/Public/DataAsset/DataAsset_FishingComponentConfig.h, Source/FishingFeature/Private/ActorComponent/ActorComponent_FishingComponent.cpp:38-43</p>"},{"location":"fishing/#fishing-component-configuration","title":"Fishing Component Configuration","text":"<p>The <code>UActorComponent_FishingComponent</code> is the central component that manages the fishing state machine and logic. Its behavior is configured via <code>UDataAsset_FishingComponentConfig</code>.</p>"},{"location":"fishing/#udataasset_fishingcomponentconfig","title":"<code>UDataAsset_FishingComponentConfig</code>","text":"<p>This Data Asset contains an <code>FFishingComponentConfig</code> struct, which holds parameters related to casting, targeting, and asset references.</p> <p><pre><code>// Source/FishingFeature/Public/DataAsset/DataAsset_FishingComponentConfig.h:17\nUCLASS()\nclass FISHINGFEATURE_API UDataAsset_FishingComponentConfig : public UDataAsset\n{\n    GENERATED_BODY()\n\npublic:\n    /*\n     * Returns the fishing component config.\n     */\n    FORCEINLINE FFishingComponentConfig GetFishingComponentConfig() const { return FishingComponentConfig; }\n\nprotected:\n    /*\n     * The fishing component config.\n     */\n    UPROPERTY(EditDefaultsOnly, Category = \"Fishing Component Config\")\n    FFishingComponentConfig FishingComponentConfig;\n};\n</code></pre> Sources: Source/FishingFeature/Public/DataAsset/DataAsset_FishingComponentConfig.h:17-37</p> <p>The component retrieves these values to control gameplay logic, such as calculating the cast distance based on how long the cast action is held.</p> <p><pre><code>// Source/FishingFeature/Private/ActorComponent/ActorComponent_FishingComponent.cpp:665\nvoid UActorComponent_FishingComponent::DetermineCastLocation(const float&amp; InElapsedTime)\n{\n    // ...\n    const FFishingComponentConfig FishingComponentConfig = FishingComponentConfigData-&gt;GetFishingComponentConfig();\n\n    const float MaximumTimeToCast = FishingComponentConfig.MaximumTimeToCast;\n    const float MinimumCastDistance = FishingComponentConfig.MinimumCastDistance;\n    const float MaximumCastDistance = FishingComponentConfig.MaximumCastDistance;\n\n    const float MappedForwardDistance = FMath::GetMappedRangeValueClamped(FVector2D(0.f, MaximumTimeToCast), FVector2D(MinimumCastDistance, MaximumCastDistance), InElapsedTime);\n    // ...\n}\n</code></pre> Sources: Source/FishingFeature/Private/ActorComponent/ActorComponent_FishingComponent.cpp:665-683</p>"},{"location":"fishing/#fishing-rod-configuration","title":"Fishing Rod Configuration","text":"<p>The <code>AActor_FishingRod</code> is responsible for the visual representation and movement of the fishing rod and its bobber. Its configuration, defined in <code>UDataAsset_FishingRodConfig</code>, primarily controls the animation of the bobber using <code>UCurveFloat</code> assets.</p>"},{"location":"fishing/#udataasset_fishingrodconfig","title":"<code>UDataAsset_FishingRodConfig</code>","text":"<p>This asset provides curves that drive timelines for the bobber's movement when it is cast (<code>Throw</code>) and reeled back.</p> <p>The <code>SetupTimelines</code> function in <code>AActor_FishingRod</code> reads the curve assets from the config and binds them to <code>FTimeline</code> objects.</p> <p><pre><code>// Source/FishingFeature/Private/Actor/Actor_FishingRod.cpp:97\nvoid AActor_FishingRod::SetupTimelines()\n{\n    if (!FishingRodConfigData)\n    {\n        //...\n        return;\n    }\n\n    const FFishingRodConfig FishingRodConfig = FishingRodConfigData-&gt;GetFishingRodConfig();\n\n    UCurveFloat* BobberReelInCurve = FishingRodConfig.BobberReelInCurve;\n    if (BobberReelInCurve)\n    {\n        BIND_TIMELINE(ThrowReelInFloatUpdate, &amp;ThisClass::OnThrowReelInUpdate, ThrowReelInFinishedEvent, &amp;ThisClass::OnThrowReelInFinished)\n\n        SetupTimelineDataAndCallbacks(&amp;ThrowReelInTimeline, ThrowReelInFloatUpdate, ThrowReelInFinishedEvent, BobberReelInCurve);\n    }\n    // ...\n}\n</code></pre> This allows designers to visually author the acceleration and deceleration of the bobber's movement in the editor.</p> <p>Sources: Source/FishingFeature/Private/Actor/Actor_FishingRod.cpp:97-120, Source/FishingFeature/Public/Actor/Actor_FishingRod.h:60-61</p>"},{"location":"fishing/#fish-actor-configuration","title":"Fish Actor Configuration","text":"<p>The behavior of individual fish is defined by <code>UDataAsset_ActorFishConfig</code>. This allows for different types of fish with unique movement characteristics and sounds.</p>"},{"location":"fishing/#udataasset_actorfishconfig","title":"<code>UDataAsset_ActorFishConfig</code>","text":"<p>This Data Asset contains an <code>FActorFishConfig</code> struct with parameters controlling the fish's AI and interaction behaviors.</p> Property Type Description <code>FishRotationSpeed</code> <code>float</code> The speed at which the fish turns while wandering. <code>FishMoveSpeed</code> <code>float</code> The speed at which the fish moves while wandering. <code>FishWanderTargetRadius</code> <code>float</code> The radius around a wander target point. Once the fish enters this radius, it selects a new target. <code>FishReelingInCurve</code> <code>UCurveFloat*</code> A curve asset that controls the fish's movement when it's being reeled towards the bobber. <code>FishEscapedCurve</code> <code>UCurveFloat*</code> A curve asset that controls the fish's movement when it escapes back to its original location. <code>FishBiteSound</code> <code>USoundBase*</code> The sound played when the fish \"bites\" the bobber. <p>The <code>AActor_Fish</code> class retrieves these values in <code>SetupFishMovementValues</code> and uses them in its <code>WanderWithinBoundingBox</code> logic, which runs every tick.</p> <p><pre><code>graph TD\n    subgraph \"Configuration\"\n        ConfigAsset(DA_ActorFishConfig)\n    end\n\n    subgraph \"Initialization\"\n        A[AActor_Fish::BeginPlay] --&gt; B(AActor_Fish::SetupFishMovementValues);\n        B -- \"Reads values from\" --&gt; ConfigAsset;\n        B --&gt; C{Cache values like&lt;br&gt;FishMoveSpeed,&lt;br&gt;FishRotationSpeed};\n    end\n\n    subgraph \"Runtime (Tick)\"\n        D[AActor_Fish::Tick] --&gt; E(AActor_Fish::WanderWithinBoundingBox);\n        E -- \"Uses cached values to\" --&gt; F(Calculate new location &amp; rotation);\n        F --&gt; G(SetActorLocationAndRotation);\n    end\n</code></pre> This diagram illustrates the data flow from the <code>DA_ActorFishConfig</code> asset to the <code>AActor_Fish</code>'s movement logic. Values are read once during initialization and then used every frame to drive the fish's wandering behavior.</p> <p>Sources: Source/FishingFeature/Public/DataAsset/DataAsset_ActorFishConfig.h, Source/FishingFeature/Private/Actor/Actor_Fish.cpp:57-70, 149-166</p>"},{"location":"fishing/#fish-spawning-configuration","title":"Fish Spawning Configuration","text":"<p>The <code>AActor_FishSpawnArea</code> is a volume that handles the spawning of fish within its bounds. It uses <code>UDataAsset_FishSpawnAreaConfig</code> to determine what kind of fish to spawn and how many.</p>"},{"location":"fishing/#udataasset_fishspawnareaconfig","title":"<code>UDataAsset_FishSpawnAreaConfig</code>","text":"<p>This Data Asset holds an <code>FFishSpawnAreaConfig</code> struct.</p> Property Type Description <code>FishActorClass</code> <code>TSoftClassPtr&lt;AActor&gt;</code> A soft reference to the fish actor class to be spawned. Using a soft pointer allows for asynchronous loading. <code>FishSpawnAmount</code> <code>int32</code> The number of fish to spawn within the area. <p>The spawning process is asynchronous to avoid hitches when loading fish assets. The <code>AActor_FishSpawnArea</code> requests the asset load on <code>BeginPlay</code> and spawns the actors in a callback once the load is complete.</p>"},{"location":"fishing/#asynchronous-spawning-flow","title":"Asynchronous Spawning Flow","text":"<p><pre><code>sequenceDiagram\n    participant A as AActor_FishSpawnArea\n    participant B as UAssetManager\n    participant C as StreamableManager\n\n    A-&gt;&gt;A: BeginPlay()\n    A-&gt;&gt;A: RequestLoadFishAssetSoftClass()\n    Note right of A: Reads FishActorClass from its Data Asset\n    A-&gt;&gt;+B: GetStreamableManager()\n    B--&gt;&gt;-A: Returns StreamableManager\n    A-&gt;&gt;+C: RequestAsyncLoad(FishActorClass, OnFishSpawnAssetLoaded)\n    C--&gt;&gt;-A: Returns FStreamableHandle\n\n    Note over A,C: ...Time passes while asset loads...\n\n    C-&gt;&gt;A: OnFishSpawnAssetLoaded() callback\n    A-&gt;&gt;A: SpawnFishes()\n    loop For each FishSpawnAmount\n        A-&gt;&gt;A: SpawnActorDeferred()\n        A-&gt;&gt;A: SetSpawnAreaCenterAndExtent()\n        A-&gt;&gt;A: FinishSpawning()\n    end\n</code></pre> This sequence diagram shows how <code>AActor_FishSpawnArea</code> initiates an asynchronous load of the fish actor class. The <code>UAssetManager</code> handles the loading in the background. Once complete, the <code>OnFishSpawnAssetLoaded</code> callback is executed, which then proceeds to spawn the configured number of fish.</p> <p>Sources: Source/FishingFeature/Public/DataAsset/DataAsset_FishSpawnAreaConfig.h, Source/FishingFeature/Private/Actor/Actor_FishSpawnArea.cpp:32-44, 72-91</p>"},{"location":"fishing/#conclusion_2","title":"Conclusion","text":"<p>The extensive use of Data Assets for configuration is a cornerstone of the fishing feature's design. It provides a clean separation between data and logic, empowering designers to iterate on gameplay balance, asset usage, and behavior without requiring engineering support. This modular and data-driven approach makes the system scalable and easy to maintain.</p> <p></p>"},{"location":"fishing/#ui-widgets","title":"UI Widgets","text":""},{"location":"fishing/#related-pages_8","title":"Related Pages","text":"<p>Related topics: Fishing Gameplay Loop</p> Relevant source files  The following files were used as context for generating this wiki page:  - [Source/StairwayFishingGameUI/Private/UserWidget/MeterBar/UserWidgetMeterBar_CastMeterBar.cpp](https://github.com/rezonated/Unreal-Fishing-Test/blob/main/Source/StairwayFishingGameUI/Private/UserWidget/MeterBar/UserWidgetMeterBar_CastMeterBar.cpp) - [Source/StairwayFishingGameUI/Private/UserWidget/UserWidget_FishingDoneScreen.cpp](https://github.com/rezonated/Unreal-Fishing-Test/blob/main/Source/StairwayFishingGameUI/Private/UserWidget/UserWidget_FishingDoneScreen.cpp) - [Source/StairwayFishingGameUI/Public/UserWidget/UserWidget_MainOverlay.h](https://github.com/rezonated/Unreal-Fishing-Test/blob/main/Source/StairwayFishingGameUI/Public/UserWidget/UserWidget_MainOverlay.h) - [Source/FishingFeature/Private/ActorComponent/ActorComponent_FishingComponent.cpp](https://github.com/rezonated/Unreal-Fishing-Test/blob/main/Source/FishingFeature/Private/ActorComponent/ActorComponent_FishingComponent.cpp) - [Source/StairwayFishingGameCore/Private/GameModeBase/GameModeBase_StairwayFishingGame.cpp](https://github.com/rezonated/Unreal-Fishing-Test/blob/main/Source/StairwayFishingGameCore/Private/GameModeBase/GameModeBase_StairwayFishingGame.cpp) - [Source/StairwayFishingGameCore/Public/Pawn/Pawn_StairwayFishingGame.h](https://github.com/rezonated/Unreal-Fishing-Test/blob/main/Source/StairwayFishingGameCore/Public/Pawn/Pawn_StairwayFishingGame.h)"},{"location":"fishing/#ui-widgets_1","title":"UI Widgets","text":"<p>The UI system in the Stairway Fishing Game provides visual feedback to the player for key gameplay actions, such as casting power and end-of-round options. The system is designed to be decoupled from the core gameplay logic, reacting to events broadcasted through the <code>VAGameplayMessagingSubsystem</code>. This event-driven architecture allows for flexible and maintainable UI components that respond to specific gameplay tags and payloads.</p> <p>The primary UI components include a main overlay that acts as a container, a dynamic cast meter bar that reflects the player's casting charge, and a \"Fishing Done\" screen that appears after a fish is successfully caught. These widgets are primarily managed through C++ logic, with their visual layout defined in Blueprint User Widgets.</p>"},{"location":"fishing/#ui-architecture-overview","title":"UI Architecture Overview","text":"<p>The UI is structured with a main container widget, <code>UUserWidget_MainOverlay</code>, which holds other specialized widgets. The <code>APawn_StairwayFishingGame</code> pawn directly incorporates the <code>CastMeterBarWidget</code> as a <code>UWidgetComponent</code>, while the <code>UserWidget_MainOverlay</code> is likely added to the viewport by the game's HUD management system.</p> <p>This diagram illustrates the composition of the UI widgets.</p> <p><pre><code>graph TD\n    subgraph \"Game UI\"\n        A[UUserWidget_MainOverlay] --&gt; B[UUserWidget_FishingDoneScreen];\n        C(APawn_StairwayFishingGame) --&gt; D[UWidgetComponent: CastMeterBarWidget];\n    end\n</code></pre> *   <code>UUserWidget_MainOverlay</code> is the top-level widget containing the <code>FishingDoneScreen</code>. *   The <code>APawn_StairwayFishingGame</code> contains the <code>CastMeterBarWidget</code> as a component, which renders the <code>UUserWidgetMeterBar_CastMeterBar</code>.</p> <p>Sources: Source/StairwayFishingGameUI/Public/UserWidget/UserWidget_MainOverlay.h:17-18, Source/StairwayFishingGameCore/Public/Pawn/Pawn_StairwayFishingGame.h:71-72</p>"},{"location":"fishing/#key-ui-widgets","title":"Key UI Widgets","text":"Widget Class Description Source File <code>UUserWidget_MainOverlay</code> The main overlay for the game, acting as a container for other UI elements like the fishing done screen. <code>UserWidget_MainOverlay.h</code> <code>UUserWidgetMeterBar_CastMeterBar</code> A progress bar that visually represents the power of the player's cast. Its value and color are updated dynamically based on gameplay events. <code>UserWidgetMeterBar_CastMeterBar.cpp</code> <code>UUserWidget_FishingDoneScreen</code> A screen that appears after a fishing attempt is complete, typically showing buttons to restart or quit. <code>UserWidget_FishingDoneScreen.cpp</code>"},{"location":"fishing/#cast-meter-bar","title":"Cast Meter Bar","text":"<p>The <code>UUserWidgetMeterBar_CastMeterBar</code> provides real-time feedback to the player during the casting action. It listens for messages from the gameplay system to update its progress and color.</p> <p>Sources: Source/StairwayFishingGameUI/Private/UserWidget/MeterBar/UserWidgetMeterBar_CastMeterBar.cpp</p>"},{"location":"fishing/#initialization-and-state","title":"Initialization and State","text":"<p>Upon construction (<code>NativeConstruct</code>), the meter bar initializes itself to a progress of 0 and becomes hidden. It then registers a listener for UI update messages.</p> <p><pre><code>// Source/StairwayFishingGameUI/Private/UserWidget/MeterBar/UserWidgetMeterBar_CastMeterBar.cpp:27-33\nvoid UUserWidgetMeterBar_CastMeterBar::NativeConstruct()\n{\n    Super::NativeConstruct();\n\n    ListenForUICastUpdateMessage();\n\n    InitializeMeterBar();\n}\n</code></pre> Sources: Source/StairwayFishingGameUI/Private/UserWidget/MeterBar/UserWidgetMeterBar_CastMeterBar.cpp:27-33</p>"},{"location":"fishing/#event-listening-and-data-flow","title":"Event Listening and Data Flow","text":"<p>The cast meter's logic is driven by the <code>VAGameplayMessagingSubsystem</code>. It subscribes to a specific channel identified by the <code>Messaging_Fishing_UI_Cast_Update</code> gameplay tag.</p> <p>The sequence of events for updating the cast meter is as follows: 1.  The <code>PlayerController</code> detects a \"Cast\" input action. 2.  It notifies the <code>UActorComponent_FishingComponent</code> attached to the pawn. 3.  The <code>FishingComponent</code> calculates the cast progress as a float value. 4.  It broadcasts this float value on the <code>Messaging_Fishing_UI_Cast_Update</code> channel. 5.  The <code>UUserWidgetMeterBar_CastMeterBar</code>, which is listening on this channel, receives the message. 6.  It updates its progress bar's percentage and color based on the received float value.</p> <p><pre><code>sequenceDiagram\n    participant PC as PlayerController\n    participant FC as FishingComponent\n    participant GMS as VAGameplayMessagingSubsystem\n    participant CMB as CastMeterBar\n\n    PC-&gt;&gt;+FC: OnCastAction(elapsedTime)\n    FC-&gt;&gt;FC: GetMappedElapsedTimeToMaximumCastTime()\n    FC-&gt;&gt;+GMS: BroadcastMessage(UI_Cast_Update, progress_float)\n    GMS--&gt;&gt;-FC: \n    GMS-&gt;&gt;+CMB: OnGameplayMessageReceived(payload: float)\n    CMB-&gt;&gt;CMB: SetProgress(progress)\n    CMB-&gt;&gt;CMB: SetProgressBarColor(color)\n    CMB-&gt;&gt;CMB: ToggleVisibility(true)\n    CMB--&gt;&gt;-GMS: \n    FC--&gt;&gt;-PC: \n</code></pre> This diagram illustrates the message flow from player input to the UI update for the cast meter.</p> <p>The <code>OnFishingMessageReceived</code> function handles the incoming message, validates that the payload is a float, and then updates the UI elements. The progress bar's color is determined by sampling a <code>UCurveLinearColor</code> asset (<code>CastMeterBarColorCurve</code>) at the given progress value.</p> <p><pre><code>// Source/StairwayFishingGameUI/Private/UserWidget/MeterBar/UserWidgetMeterBar_CastMeterBar.cpp:92-108\nvoid UUserWidgetMeterBar_CastMeterBar::OnFishingMessageReceived(const FGameplayTag&amp; Channel,\n    const FVAAnyUnreal&amp;                                                             MessagePayload)\n{\n    // ... payload validation ...\n\n    const float        Progress = MessagePayload.Get&lt;float&gt;();\n    const FLinearColor Color = GetColorForProgress(Progress);\n\n    const bool bShouldBeVisible = Progress &gt; 0.f;\n    ToggleVisibility(bShouldBeVisible);\n\n    SetProgress(Progress);\n    SetProgressBarColor(Color);\n}\n</code></pre> Sources: Source/StairwayFishingGameUI/Private/UserWidget/MeterBar/UserWidgetMeterBar_CastMeterBar.cpp:92-108, Source/FishingFeature/Private/ActorComponent/ActorComponent_FishingComponent.cpp:728-731</p>"},{"location":"fishing/#fishing-done-screen","title":"Fishing Done Screen","text":"<p>The <code>UUserWidget_FishingDoneScreen</code> is a widget that becomes visible at the end of a successful fishing sequence, presenting the player with further options. Its visibility is controlled by the game's overall state.</p> <p>Sources: Source/StairwayFishingGameUI/Private/UserWidget/UserWidget_FishingDoneScreen.cpp</p>"},{"location":"fishing/#visibility-control","title":"Visibility Control","text":"<p>Similar to the cast meter, this widget listens for messages via the <code>VAGameplayMessagingSubsystem</code>. It subscribes to the <code>Messaging_GameMode_StateChangeFinish</code> channel. When it receives a message, it checks if the payload <code>FGameplayTag</code> matches <code>FishingGameLoopState_ShowFish</code>. If it does, the widget's button container becomes visible.</p> <p>The flow for showing the \"Fishing Done\" screen is: 1.  The <code>FishingComponent</code> determines a fish has been caught and notifies the system to change the game state to <code>ShowFish</code>. 2.  The <code>GameMode</code> processes this state change. 3.  After the state transition is complete (including camera fades), the <code>GameMode</code> broadcasts a <code>Messaging_GameMode_StateChangeFinish</code> message with the new state tag (<code>FishingGameLoopState_ShowFish</code>). 4.  The <code>UUserWidget_FishingDoneScreen</code> receives this message and makes its buttons visible.</p> <p><pre><code>sequenceDiagram\n    participant FC as FishingComponent\n    participant GMS as VAGameplayMessagingSubsystem\n    participant GM as GameMode\n    participant FDS as FishingDoneScreen\n\n    FC-&gt;&gt;+GMS: BroadcastMessage(GameState_StateChange, ShowFish)\n    GMS--&gt;&gt;-FC: \n\n    Note over GMS, GM: GameState notifies GameMode\n\n    GM-&gt;&gt;+GM: OnFishingGameLoopStateChanged(ShowFish)\n    GM-&gt;&gt;GM: TriggerScreenFadeInOut()\n\n    loop Fade-in Timer\n        GM-&gt;&gt;+GMS: BroadcastMessage(StateChangeFinish, ShowFish)\n        GMS--&gt;&gt;-GM: \n    end\n\n    GMS-&gt;&gt;+FDS: OnFishingGameLoopStateChanged(payload: ShowFish)\n    FDS-&gt;&gt;FDS: ToggleWidgetButtonsContainerVisibility(true)\n    FDS--&gt;&gt;-GMS: \n</code></pre> This diagram shows the event sequence that leads to the \"Fishing Done\" screen being displayed.</p> <p>Sources: Source/StairwayFishingGameUI/Private/UserWidget/UserWidget_FishingDoneScreen.cpp:68-83, Source/StairwayFishingGameCore/Private/GameModeBase/GameModeBase_StairwayFishingGame.cpp:89-93, Source/FishingFeature/Private/ActorComponent/ActorComponent_FishingComponent.cpp:844-846</p>"},{"location":"fishing/#ui-message-subscriptions","title":"UI Message Subscriptions","text":"<p>The UI widgets rely on a set of predefined gameplay messages to function.</p> Message Channel Tag Payload Type Emitter(s) Listener(s) Description <code>Messaging_Fishing_UI_Cast_Update</code> <code>float</code> <code>UActorComponent_FishingComponent</code> <code>UUserWidgetMeterBar_CastMeterBar</code> Updates the cast meter's progress during the casting action. <code>Messaging_GameMode_StateChangeFinish</code> <code>FGameplayTag</code> <code>AGameModeBase_StairwayFishingGame</code> <code>UUserWidget_FishingDoneScreen</code> Signals that a game state transition has finished, used to show the UI. <p>This decoupled, message-based approach ensures that the UI can react to gameplay events without having direct dependencies on the actors or components that trigger them.</p> <p></p>"},{"location":"fishing/#functional-testing","title":"Functional Testing","text":""},{"location":"fishing/#related-pages_9","title":"Related Pages","text":"<p>Related topics: Getting Started</p> Relevant source files  The following files were used as context for generating this wiki page:  - [Source/FishingFeatureTests/Private/FunctionalTest/FunctionalTest_FishingFeatureTest.cpp](https://github.com/rezonated/Unreal-Fishing-Test/blob/main/Source/FishingFeatureTests/Private/FunctionalTest/FunctionalTest_FishingFeatureTest.cpp) - [Source/FishingFeatureTests/Private/FunctionalTest/FishingFeatureTest/FunctionalFishingFeatureTest_AbleToCatchFish.cpp](https://github.com/rezonated/Unreal-Fishing-Test/blob/main/Source/FishingFeatureTests/Private/FunctionalTest/FishingFeatureTest/FunctionalFishingFeatureTest_AbleToCatchFish.cpp) - [Source/FishingFeatureTests/Public/FunctionalTest/FishingFeatureTest/FunctionalFishingFeatureTest_AbleToCatchFish.h](https://github.com/rezonated/Unreal-Fishing-Test/blob/main/Source/FishingFeatureTests/Public/FunctionalTest/FishingFeatureTest/FunctionalFishingFeatureTest_AbleToCatchFish.h) - [Source/FishingFeatureTests/Public/FunctionalTest/FishingFeatureTest/FunctionalFishingFeatureTest_ReelTest.h](https://github.com/rezonated/Unreal-Fishing-Test/blob/main/Source/FishingFeatureTests/Public/FunctionalTest/FishingFeatureTest/FunctionalFishingFeatureTest_ReelTest.h) - [Source/FishingFeature/Private/ActorComponent/ActorComponent_FishingComponent.cpp](https://github.com/rezonated/Unreal-Fishing-Test/blob/main/Source/FishingFeature/Private/ActorComponent/ActorComponent_FishingComponent.cpp) - [Source/FishingFeature/Private/Actor/Actor_Fish.cpp](https://github.com/rezonated/Unreal-Fishing-Test/blob/main/Source/FishingFeature/Private/Actor/Actor_Fish.cpp)"},{"location":"fishing/#functional-testing_1","title":"Functional Testing","text":"<p>The project utilizes Unreal Engine's built-in Functional Test framework to automate the validation of the core fishing gameplay mechanics. These tests are designed to run within a game session, simulating player actions and verifying the responses of the <code>UActorComponent_FishingComponent</code>. The primary goal is to ensure that key features like casting, fish detection, and reeling behave as expected under various conditions.</p> <p>The testing architecture is built around a base test class, <code>AFunctionalTest_FishingFeatureTest</code>, which provides common setup and utility functions. Specific test scenarios, such as verifying the ability to catch a fish or successfully reeling one in, are implemented in derived classes. These tests interact with the fishing component through a dedicated <code>IMockableFishingInterface</code>, allowing the test framework to drive the component's state machine and listen for outcomes via delegates.</p>"},{"location":"fishing/#test-framework-architecture","title":"Test Framework Architecture","text":"<p>The functional testing setup is composed of a base class that handles common initialization and several derived classes that implement specific test cases.</p> <p>Sources: Source/FishingFeatureTests/Private/FunctionalTest/FunctionalTest_FishingFeatureTest.cpp, Source/FishingFeatureTests/Public/FunctionalTest/FishingFeatureTest/FunctionalFishingFeatureTest_AbleToCatchFish.h, Source/FishingFeatureTests/Public/FunctionalTest/FishingFeatureTest/FunctionalFishingFeatureTest_ReelTest.h</p> <pre><code>graph TD\n    A[AFunctionalTest] --&gt; B[AFunctionalTest_FishingFeatureTest];\n    B --&gt; C[AFunctionalFishingFeatureTest_AbleToCatchFish];\n    B --&gt; D[AFunctionalFishingFeatureTest_ReelTest];\n</code></pre> Functional Test Class Hierarchy <p>Sources: Source/FishingFeatureTests/Public/FunctionalTest/FishingFeatureTest/FunctionalFishingFeatureTest_AbleToCatchFish.h:13, Source/FishingFeatureTests/Public/FunctionalTest/FishingFeatureTest/FunctionalFishingFeatureTest_ReelTest.h:15</p>"},{"location":"fishing/#base-test-class-afunctionaltest_fishingfeaturetest","title":"Base Test Class: AFunctionalTest_FishingFeatureTest","text":"<p>This class serves as the foundation for all fishing-related functional tests. Its main responsibility is to prepare the test environment by locating the target <code>UActorComponent_FishingComponent</code> to be tested.</p> <ul> <li><code>PrepLookForMockableFishingComponent()</code>: This function is called at the start of a test. It finds the first player controller and its associated pawn. It then iterates through the pawn's components to find one that implements the <code>UMockableFishingInterface</code>. This interface provides the necessary hooks (<code>MockCast</code>, <code>MockCastEnd</code>, and delegates) for the test to drive and monitor the fishing component's behavior. If a valid component cannot be found, the test fails immediately.</li> </ul> <p>Sources: Source/FishingFeatureTests/Private/FunctionalTest/FunctionalTest_FishingFeatureTest.cpp:13-72</p>"},{"location":"fishing/#test-execution-flow","title":"Test Execution Flow","text":"<p>The tests simulate player input by using the <code>Tick</code> function to manage time. A common pattern is to increment a timer (<code>CurrentMockFishingTime</code>) and continuously call the <code>MockCast</code> function on the fishing component. Once the timer reaches a randomized duration, <code>MockCastEnd</code> is called to simulate the player releasing the cast action. The test then waits for delegates to be fired from the fishing component to determine the outcome.</p> <pre><code>sequenceDiagram\n    participant Test as AFunctionalTest_FishingFeatureTest\n    participant Component as UActorComponent_FishingComponent\n\n    loop Every Frame\n        Test-&gt;&gt;Test: CurrentMockFishingTime += DeltaTime\n        Test-&gt;&gt;+Component: MockCast(CurrentMockFishingTime)\n        Component--&gt;&gt;-Test: \n    end\n\n    alt CurrentMockFishingTime &gt;= RandomizedTime\n        Test-&gt;&gt;+Component: MockCastEnd()\n        Component--&gt;&gt;-Test: \n        Note over Component: Begins internal logic (casting, waiting for fish, etc.)\n    end\n</code></pre> General Test Input Simulation Flow <p>Sources: Source/FishingFeatureTests/Private/FunctionalTest/FishingFeatureTest/FunctionalFishingFeatureTest_AbleToCatchFish.cpp:27-40</p>"},{"location":"fishing/#test-scenarios","title":"Test Scenarios","text":"<p>Specific gameplay mechanics are validated through dedicated test actor classes.</p>"},{"location":"fishing/#able-to-catch-fish-test","title":"Able to Catch Fish Test","text":"<p>The <code>AFunctionalFishingFeatureTest_AbleToCatchFish</code> class is designed to verify that the fishing component can successfully detect a fish after casting.</p> <p>Purpose: To confirm that after a cast, a sphere trace is performed, a nearby \"catchable\" actor is identified, and the component transitions to the \"waiting for fish\" state.</p> <p>Execution Steps: 1.  BeginPlay: The test prepares the environment using <code>PrepLookForMockableFishingComponent</code>. It then binds a handler, <code>OnMockAbleToCatchFishDone</code>, to the corresponding delegate on the mockable interface. A random hold time for the cast is calculated. 2.  Tick: The test simulates holding down the cast button for the randomized duration. 3.  Cast End: <code>MockCastEnd</code> is called, triggering the fishing component's casting logic. 4.  Verification: The fishing component, upon the bobber landing, performs a sphere trace to find catchable actors (<code>AttemptGetNearestCatchable</code>). It then sorts them by distance and selects the nearest one. Finally, it executes the <code>MockAbleToCatchFishDoneDelegate</code> with <code>true</code> if a catchable was found, or <code>false</code> otherwise. 5.  Result: The test's <code>OnMockAbleToCatchFishDone</code> handler receives the result. If the result is <code>true</code>, the test passes; otherwise, it fails.</p> <pre><code>sequenceDiagram\n    autonumber\n    participant Test as AFunctionalFishingFeatureTest_AbleToCatchFish\n    participant Component as UActorComponent_FishingComponent\n\n    Test-&gt;&gt;+Component: OnMockAbleToCatchFishDone().BindUObject()\n    Component--&gt;&gt;-Test: Delegate bound\n\n    loop Until RandomizedMockFishingTime\n        Test-&gt;&gt;+Component: MockCast(CurrentTime)\n        Component--&gt;&gt;-Test: \n    end\n\n    Test-&gt;&gt;+Component: MockCastEnd()\n    Note over Component: Initiates cast animation and logic\n    Component--&gt;&gt;-Test: \n\n    Note over Component: Bobber lands...\n    Component-&gt;&gt;+Component: AttemptGetNearestCatchable()\n    Note right of Component: Sphere trace for fish\n\n    alt Fish found\n        Component--&gt;&gt;-Test: MockAbleToCatchFishDoneDelegate.Execute(true)\n    else No fish found\n        Component--&gt;&gt;-Test: MockAbleToCatchFishDoneDelegate.Execute(false)\n    end\n\n    Test-&gt;&gt;Test: OnMockAbleToCatchFishDone(bSuccess)\n    Test-&gt;&gt;Test: FinishTest(Succeeded or Failed)\n</code></pre> \"Able to Catch Fish\" Test Sequence <p>Sources: Source/FishingFeatureTests/Private/FunctionalTest/FishingFeatureTest/FunctionalFishingFeatureTest_AbleToCatchFish.cpp:16-52, Source/FishingFeature/Private/ActorComponent/ActorComponent_FishingComponent.cpp:789-854</p>"},{"location":"fishing/#reel-in-test","title":"Reel In Test","text":"<p>The <code>AFunctionalFishingFeatureTest_ReelTest</code> class validates the player's ability to reel in a fish. This test is more complex as it involves multiple stages of the fishing process and can be configured to test both success and failure scenarios.</p> <p>Purpose: To confirm the entire sequence from casting, waiting for a fish to bite, and reeling it in. The <code>bExpectedResult</code> property allows the test to verify both successful reels and failures (e.g., reeling in too early).</p> Property Type Description <code>MinMockHoldFishingTime</code> <code>float</code> Minimum time to simulate holding the cast action. <code>MaxMockHoldFishingTime</code> <code>float</code> Maximum time to simulate holding the cast action. <code>MinMockReelInTime</code> <code>float</code> Minimum delay before simulating the reel-in action after a fish is on the line. <code>MaxMockReelInTime</code> <code>float</code> Maximum delay before simulating the reel-in action after a fish is on the line. <code>bExpectedResult</code> <code>bool</code> The expected outcome of the test (<code>true</code> for a successful catch, <code>false</code> for a failed one). <p>Sources: Source/FishingFeatureTests/Public/FunctionalTest/FishingFeatureTest/FunctionalFishingFeatureTest_ReelTest.h:69-99</p> <p>Execution Steps: 1.  BeginPlay: The test binds to two delegates: <code>OnMockReelInDone</code> and <code>OnBobberLandsOnWater</code>. 2.  Casting: The test simulates a cast, similar to the \"Able to Catch Fish\" test. 3.  Bobber Lands: The <code>OnBobberLandsOnWater</code> delegate is triggered by the fishing component. The test handler for this delegate then starts another timer to simulate waiting for the fish to bite before reeling. 4.  Reeling: After a randomized <code>ReelInTime</code>, the test calls <code>OnCastAction</code> again, which, in the <code>AbleToReel</code> state, triggers the catch logic. 5.  Verification: The fishing component processes the reel-in action. If the state is correct (<code>AbleToReel</code>), it attaches the fish and reels back, eventually firing <code>MockReelInDoneDelegate</code> with <code>true</code>. If the player reels too early (while in <code>WaitingForFish</code> state), the fish escapes, and the delegate is fired with <code>false</code>. 6.  Result: The <code>OnMockReelInDone</code> handler compares the boolean result from the delegate with its configured <code>bExpectedResult</code> to determine if the test passed or failed.</p> <p>Sources: Source/FishingFeature/Private/ActorComponent/ActorComponent_FishingComponent.cpp:756-787, Source/FishingFeature/Private/ActorComponent/ActorComponent_FishingComponent.cpp:328-348, Source/FishingFeature/Private/Actor/Actor_Fish.cpp:32-39</p>"},{"location":"fishing/#summary_1","title":"Summary","text":"<p>The functional testing suite provides an automated and reliable way to validate the fishing feature's complex state machine. By simulating player actions and using a mockable interface with delegates, the tests can confirm the correctness of critical gameplay flows, from casting and finding a fish to successfully reeling it in. This ensures that changes to the fishing component or related data assets do not introduce regressions and that the core mechanic remains stable.</p>"}]}